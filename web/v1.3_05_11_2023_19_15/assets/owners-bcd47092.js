import{r as u,f as w,j as a,L as q,a as r,F as Ce,h as E}from"./index-3ed1fa78.js";import{u as Ne,H as ye,D as I,C as d,a as ve}from"./HeaderData-f8341142.js";import{B as we}from"./Box-2f3a3966.js";import{E as Ee}from"./EditIcon-72ee5f20.js";import{D as Pe}from"./DeleteIcon-e6cc714b.js";import{C as Ae,F as Fe}from"./FormActionBtns-c23092d4.js";import{C as p}from"./CustomInput-6ca7ad9c.js";import{u as Se}from"./FormError-a3fab181.js";import{R as Te,D as $}from"./RequestError-ce21148f.js";import{F as g}from"./FieldsetGroup-13ce1fee.js";import{u as Me}from"./useOwners-dbc72c45.js";import{p as Le}from"./provinces-d69f2b85.js";import{C as Ve}from"./CloseOnClick-54123682.js";import{v as De}from"./form-3a2308eb.js";import{E as Oe}from"./EmptyData-5a33961e.js";import{C as Be}from"./CustomTextArea-ed7f84a9.js";import{B as je}from"./BoxContainerPage-d81583a3.js";import"./useQuery-6083f14c.js";const oa=()=>{var L,V,D;const[R,f]=u.useState(!1),[P,k]=u.useState(!1),[C,b]=u.useState(!1),{values:l,handleInputChange:c,reset:N,updateAll:G}=Se({fullName:"",email:"",phone:"",fixedPhone:"",cuit:"",province:"",city:"",address:"",codePostal:"",obs:"",commision:0}),{fullName:H,email:J,phone:K,cuit:U,province:_,city:z,address:Q,codePostal:W,obs:X,fixedPhone:Y,commision:Z}=l,[ee,ae]=u.useState(""),[s,A]=u.useState(),[F,S]=u.useState(!1),[re,oe]=u.useState([]),[te,se]=u.useState(),[T,le]=u.useState({global:{value:null,matchMode:w.CONTAINS},fullName:{value:null,matchMode:w.CONTAINS},cuit:{value:null,matchMode:w.CONTAINS}}),m=u.useRef(),{showAndHideModal:h}=Ne(),{data:o,isError:ie,isLoading:ne,error:de,isFetching:ce,refetch:qe}=Me(),me=e=>{G({...e}),M(e.province),f(!0),S(!0),m.current=e},ue=e=>{k(!P),m.current=e},he=async e=>{var x,O,B;e.preventDefault();const{error:t,ok:n}=De({...l},["obs","fixedPhone","codePostal","city","province"]);if(A(t),!n)return!1;if(F)try{b(!0);const i=await E.put(`/owners/${(x=m.current)==null?void 0:x.id}`,l);i.data.ok?(o!=null&&o.data&&(o.data=o==null?void 0:o.data.map(v=>{var j;return v.id===((j=m.current)==null?void 0:j.id)&&(v={fullName:l.fullName,email:l.email,phone:l.phone,cuit:l.cuit,province:l.province,city:l.city,address:l.address,codePostal:l.codePostal,fixedPhone:l.fixedPhone,commision:l.commision,obs:l.obs,id:m.current.id,createdAt:m.current.createdAt,updatedAt:m.current.updatedAt}),v})),N(),f(!1),h("Editado",i.data.message)):h("Error",i.data.message||"Algo malo ocurrío.","red")}catch(i){i.response&&h("Error",((O=i.response.data)==null?void 0:O.message)||"Algo malo ocurrío.","red")}finally{b(!1)}else try{b(!0);const i=await E.post("/owners",l);i.data.ok?(o==null||o.data.unshift(i.data.data),N(),f(!1),h("Guardado",i.data.message)):h("Error",i.data.message||"Algo malo ocurrío.","red")}catch(i){i.response&&h("Error",((B=i.response.data)==null?void 0:B.message)||"Algo malo ocurrío.","red")}finally{b(!1)}},pe=async e=>{var t;try{b(!0);const n=await E.delete("/owners/"+e);n.data.ok?(o!=null&&o.data&&(o.data=o==null?void 0:o.data.filter(x=>x.id!==e)),k(!1),h("Borrado",n.data.message)):h("Error",n.data.message||"Algo malo ocurrío.","red")}catch(n){n.response&&h("Error",((t=n.response.data)==null?void 0:t.message)||"Algo malo ocurrío.","red")}finally{b(!1)}},y=()=>{N(),f(!1),A({})},be=e=>{const t=e;let n={...T};n.global.value=t,le(n),ae(t)},ge=e=>r("div",{className:"flex gap-x-3 items-center justify-center",children:[a(Ee,{action:()=>me(e)}),a(Pe,{action:()=>ue(e)})]}),M=async e=>{const n=await(await fetch(`https://apis.datos.gob.ar/georef/api/localidades?provincia=${e}&campos=nombre&max=1000`)).json();oe(n.localidades)},fe=e=>r("div",{className:"p-3",children:[r("h5",{children:["Propiedades de ",e.fullName]}),r(I,{size:"small",dataKey:"id",className:"!overflow-hidden   !border-none",responsiveLayout:"scroll",value:e.Properties,children:[a(d,{field:"PropertyType.description",header:"Tipo Propiedad",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(d,{header:"Dirección",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",body:t=>r("span",{children:[t.street," ",t.number," ",t.floor,"-",t.dept]}),sortable:!0}),a(d,{header:"Estado",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",body:t=>r("span",{className:`font-bold ${t.state==="Libre"?"text-green-500":"text-red-500"}`,children:[t.state," "]})}),a(d,{headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",field:"isFor",header:"Para"})]})]}),xe=e=>{var t;return((t=e.Properties)==null?void 0:t.length)>0},ke=()=>{S(!1),m.current=null,f(!0)};return ne?a(q,{}):ie?a(Te,{error:de}):r(je,{children:[a(ye,{action:ke,text:"Propietarios"}),((L=o.data)==null?void 0:L.length)>0?r(Ce,{children:[a(p,{onChange:e=>be(e),className:" w-auto mx-2 sm:mx-0 sm:w-96",initialValue:ee,placeholder:"Buscar propietario",type:"search"}),a(we,{className:"!p-0 !overflow-hidden !border-none sm:mx-0   mb-4 ",children:r(I,{expandedRows:te,onRowToggle:e=>se(e.data),rowExpansionTemplate:fe,size:"small",emptyMessage:"Aún no hay propietario",className:"!overflow-hidden !border-none",value:o==null?void 0:o.data,filters:T,globalFilterFields:["fullName","cuit"],dataKey:"id",responsiveLayout:"scroll",children:[a(d,{expander:xe,headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",style:{width:"0.5rem"}}),a(d,{field:"fullName",header:"Nombre",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(d,{field:"cuit",header:"Cuit/Cuil",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(d,{field:"email",header:"Correo",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(d,{field:"phone",header:"Celular",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(d,{field:"address",body:e=>r("span",{children:[e.city||"-",", ",e.address]}),header:"Dirección",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(d,{field:"commision",header:"Comisión",body:e=>r("span",{children:[" ",e.commision,"% "]}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(d,{body:ge,headerClassName:"!border-none dark:!bg-gray-800",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",exportable:!1,style:{width:90}})]})})]}):a(Oe,{text:"Aún no hay propietario "}),ce&&a(q,{h:40,w:40}),a(ve,{show:P,savingOrUpdating:C,setShow:k,destroy:()=>{var e;return pe((e=m.current)==null?void 0:e.id)},text:`${(V=m.current)==null?void 0:V.fullName} | ${(D=m.current)==null?void 0:D.cuit}`}),a(Ae,{show:R,className:"max-w-[750px]",closeModal:y,titleText:`${F?"Editar":"Crear"} propietario`,children:r("form",{onSubmit:he,className:`${C&&"disabled-all"}`,children:[a(Ve,{action:y}),r(g,{children:[a(p,{placeholder:"Juan Jose",initialValue:H||"",onChange:e=>c(e,"fullName"),maxLength:100,label:"Nombre Completo",required:!0,hasError:s==null?void 0:s.fullName,errorText:"El nombre es obligatorio."}),a(p,{placeholder:"example@gmail.com",initialValue:J||"",type:"email",onChange:e=>c(e,"email"),maxLength:255,label:"Email",required:!0,hasError:s==null?void 0:s.email,errorText:"El correo es obligatorio."})]}),r(g,{children:[r(g,{className:"w-full sm:w-[50%]",children:[a(p,{placeholder:"20909239120",initialValue:U||"",onChange:e=>c(e,"cuit"),maxLength:255,label:"Cuit/Cuil",required:!0,hasError:s==null?void 0:s.cuit,errorText:"El cuit/cuil es obligatorio."}),a(p,{placeholder:"10",type:"number",initialValue:Z||"",onChange:e=>c(e,"commision"),label:"%Comision",max:100,min:0,required:!0,hasError:s==null?void 0:s.commision,errorText:"La comision es obligatoria."})]}),r(g,{className:"w-full sm:w-[50%]",children:[a(p,{placeholder:"3417207882",initialValue:K||"",onChange:e=>c(e,"phone"),maxLength:20,label:"Teléfono",required:!0,hasError:s==null?void 0:s.phone,errorText:"El teléfono es obligatorio."}),a(p,{placeholder:"3417207882",initialValue:Y||"",onChange:e=>c(e,"fixedPhone"),maxLength:20,label:"Tel. fijo",optional:!0})]})]}),r(g,{children:[r("fieldset",{className:"",children:[r("label",{htmlFor:"province",children:["Provincia ",a("span",{className:"text-xs opacity-50",children:"(opcional)"})," "]}),a($,{value:_,onChange:e=>{c(e.value,"province"),M(e.value)},filterPlaceholder:"santa fe",options:Le,optionValue:"nombre",optionLabel:"nombre",placeholder:"elije una provincia",filter:!0,className:"h-[42px] items-center"})]}),r("fieldset",{className:"",children:[r("label",{htmlFor:"city",children:["Ciudad ",a("span",{className:"text-xs opacity-50",children:"(opcional)"})," "]}),a($,{value:z,onChange:e=>c(e.value,"city"),options:re,filterPlaceholder:"rosario",optionLabel:"nombre",optionValue:"nombre",placeholder:"elije una ciudad",filter:!0,className:"h-[42px] items-center"})]})]}),r(g,{children:[a(p,{placeholder:"Sarmiento 1247",initialValue:Q||"",onChange:e=>c(e,"address"),maxLength:100,label:"Dirección",required:!0,hasError:s==null?void 0:s.address,errorText:"La dirección es obligatoria."}),a(p,{placeholder:"2000",initialValue:W||"",onChange:e=>c(e,"codePostal"),label:"Código Postal",optional:!0})]}),a(Be,{placeholder:"escribe una observación o nota de algo...",initialValue:X||"",onChange:e=>c(e,"obs"),label:"Observación",optional:!0,className:"h-16"}),a(Fe,{savingOrUpdating:C,onClose:y})]})})]})};export{oa as default};
