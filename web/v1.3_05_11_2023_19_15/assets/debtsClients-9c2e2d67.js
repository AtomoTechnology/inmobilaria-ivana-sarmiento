import{r as o,f as y,j as a,L as I,a as t,F as se,h as P}from"./index-3ed1fa78.js";import{u as le,H as oe,D as T,C as s,a as de}from"./HeaderData-f8341142.js";import{B as ne}from"./Box-2f3a3966.js";import{C as $}from"./CustomInput-6ca7ad9c.js";import{R as ie}from"./RequestError-ce21148f.js";import{u as ce}from"./useContracts-759ab8e3.js";import{f as h,e as B}from"./date-8ced1934.js";import{E as me}from"./EmptyData-5a33961e.js";import{E as ue}from"./EditIcon-72ee5f20.js";import{D as be}from"./DeleteIcon-e6cc714b.js";import{u as he}from"./FormError-a3fab181.js";import{C as pe,F as ge}from"./FormActionBtns-c23092d4.js";import{C as fe}from"./CloseOnClick-54123682.js";import{v as ke}from"./form-3a2308eb.js";import"./useQuery-6083f14c.js";const $e=()=>{var E,M,A;const[O,H]=o.useState(""),[N,j]=o.useState({global:{value:null,matchMode:y.CONTAINS},"Client.fullName":{value:null,matchMode:y.CONTAINS},"PropertyType.description":{value:null,matchMode:y.CONTAINS}}),[q,L]=o.useState(),{data:d,isError:R,isLoading:Y,error:V,isFetching:z,refetch:U}=ce("/debts/client/all"),[C,p]=o.useState(!1),{showAndHideModal:i}=le(),n=o.useRef(),[D,g]=o.useState(!1),[G,w]=o.useState(!1),[f,v]=o.useState(),{values:k,amount:x,id:S,reset:K,handleInputChange:_,updateAll:J}=he({id:0,amount:0,ContractId:0}),Q=e=>{const r=e;let l={...N};l.global.value=r,j(l),H(r)},W=e=>{p(!C),n.current=e},X=e=>{J({amount:e.amount,id:e.id,ContractId:e.ContractId}),w(!0),n.current=e},u=()=>{K(),w(!1),v({}),n.current=null},Z=async e=>{var b,F;e.preventDefault();const{error:r,ok:l}=ke({...k});if(v(r),!l)return!1;try{const c=await P.put("/debt-clients/"+S,{amount:x});c.data.ok?((b=d==null?void 0:d.data)==null||b.filter(m=>m.id===k.ContractId)[0].DebtClients.map(m=>(m.id===S&&m.ContractId===k.ContractId&&(m.amount=x),m)),u(),i("Actualizado",c.data.message)):i("Error",c.data.message||"Algo malo ocurrío.","red")}catch(c){c.response&&i("Error",((F=c.response.data)==null?void 0:F.message)||"Algo malo ocurrío.","red")}finally{g(!1)}},ee=async e=>{var r;try{g(!0);const l=await P.delete("/debt-clients/"+e);l.data.ok?(U(),p(!1),i("Borrado",l.data.message)):i("Error",l.data.message||"Algo malo ocurrío.","red")}catch(l){l.response&&i("Error",((r=l.response.data)==null?void 0:r.message)||"Algo malo ocurrío.","red")}finally{g(!1)}},ae=e=>t("div",{className:"flex gap-x-3 items-center justify-center",children:[a(ue,{action:()=>X(e)}),a(be,{action:()=>W(e)})]}),re=e=>(e==null?void 0:e.DebtClients.length)>0||!1,te=e=>t("div",{className:"p-3",children:[a("h2",{className:"text-lg font-semibold",children:"Histórico de deudas"}),t(T,{size:"small",dataKey:"id",className:"!overflow-hidden   !border-none",responsiveLayout:"scroll",value:e.DebtClients,children:[a(s,{field:"amount",body:r=>t("span",{children:[" $",r.amount," "]}),header:"Monto",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{header:"Periodo",field:"month",body:r=>t("span",{children:[r.month,"/",r.year," "]}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",field:"createdAt",body:r=>t("span",{children:[" ",h(r.createdAt.slice(0,10))," "]}),header:"Fecha creación",sortable:!0}),a(s,{header:"Descripción",field:"description",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(s,{headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",field:"paid",sortable:!0,body:r=>t("span",{className:`p-1 rounded-full px-2  ${r.paid?"text-green-400":"text-red-400"}`,children:[" ",r.paid?"Pagado":"Sin pagar"," ",r.paid&&h(r.paidDate.slice(0,10))," "]}),header:"Pago"}),a(s,{body:ae,headerClassName:"!border-none dark:!bg-gray-800",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",exportable:!1,style:{width:90}})]})]});return Y?a(I,{}):R?a(ie,{error:V}):t("div",{className:"container m-auto  flex sm:mx-0  flex-col justify-center sm:justify-center",children:[a(oe,{showBtn:!1,action:()=>{},text:"Deudas x inquilinos"}),d.data.length>0?t(se,{children:[a($,{onChange:e=>Q(e),className:" w-auto mx-2 sm:mx-0 sm:w-96",initialValue:O,placeholder:"Buscar contrato",type:"search"}),a(ne,{className:"!p-0 !overflow-hidden !border-none sm:mx-0    mb-4 ",children:t(T,{expandedRows:q,rowExpansionTemplate:te,onRowToggle:e=>L(e.data),size:"small",emptyMessage:"Aún no hay contrato",className:"!overflow-hidden   !border-none",value:d==null?void 0:d.data,filters:N,globalFilterFields:["Property.street","Client.fullName"],dataKey:"id",responsiveLayout:"scroll",children:[a(s,{expander:re,headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",style:{width:"0.5rem"}}),a(s,{field:"Property.street",body:e=>t("span",{className:`${e.DebtClients.filter(r=>!r.paid).length>0?"text-red-400":""}`,children:[e.Property.street," ",e.Property.number," ",e.Property.floor," ",e.Property.dept]}),header:"Propiedad",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"Property.folderNumber",header:"Carpeta",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"Client.fullName",body:e=>t("span",{className:`${e.DebtClients.filter(r=>!r.paid).length>0?"text-red-400":""}`,children:[e.Client.fullName," ",t("span",{className:"text-sm",children:[" (",e.Client.cuit,") "]})]}),header:"Inquilino",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"startDate",header:"Fecha inicio",body:e=>a("span",{children:h(e.startDate)}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"endDate",header:"Fecha fin",body:e=>a("span",{children:h(e.endDate)}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"state",header:"Estado",sortable:!0,body:e=>t("span",{className:"font-bold ",children:[" ",e.state]}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(s,{field:"state",header:"Año",body:e=>a("span",{className:`${B(e.startDate,new Date().toISOString().slice(0,10))===3&&"text-yellow-500 font-bold"}`,children:B(e.startDate,new Date().toISOString().slice(0,10))}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(s,{field:"",header:"Monto Actual",body:e=>{var r;return t("span",{className:"font-bold",children:["$",(r=e.PriceHistorials.sort((l,b)=>l.id-b.id)[e.PriceHistorials.length-1])==null?void 0:r.amount]})},headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "})]})})]}):a(me,{text:"Aún no hay deuda"}),z&&a(I,{h:40,w:40}),a(de,{show:C,setShow:p,savingOrUpdating:D,destroy:()=>{var e;return ee((e=n.current)==null?void 0:e.id)},text:`La deuda del periodo ${(E=n.current)==null?void 0:E.month}/${(M=n.current)==null?void 0:M.year} de  monto   $ ${(A=n.current)==null?void 0:A.amount}`}),t(pe,{show:G,closeModal:u,overlayClick:!1,className:"max-w-[1000px] sm:w-[600px]",titleText:"Editar deuda inquilino",children:[a(fe,{action:u}),t("form",{onSubmit:Z,children:[a($,{placeholder:"1234.90",type:"number",initialValue:x,onChange:e=>_(e,"amount"),label:"Monto",required:!0,hasError:f==null?void 0:f.amount,errorText:"El monto es requerido"}),a(ge,{savingOrUpdating:D,onClose:u})]})]})]})};export{$e as default};
