import{h as C,r as d,f as N,j as r,L as G,a,F as ne}from"./index-3ed1fa78.js";import{u as ie,H as de,D as ce,C as g,a as me}from"./HeaderData-f8341142.js";import{B as pe}from"./Box-2f3a3966.js";import{E as ue}from"./EditIcon-72ee5f20.js";import{D as he}from"./DeleteIcon-e6cc714b.js";import{C as fe,F as ge}from"./FormActionBtns-c23092d4.js";import{C as v}from"./CustomInput-6ca7ad9c.js";import{u as ye,F as L}from"./FormError-a3fab181.js";import{R as be,D as O}from"./RequestError-ce21148f.js";import{u as Ce}from"./useQuery-6083f14c.js";import{u as xe}from"./useContracts-759ab8e3.js";import{F as V}from"./FieldsetGroup-13ce1fee.js";import{v as ke}from"./form-3a2308eb.js";import{E as we}from"./EmptyData-5a33961e.js";import{f as Ee}from"./date-8ced1934.js";import{C as Ne}from"./CloseOnClick-54123682.js";const ve=async()=>await C.get("/client-expenses?sort=ContractId").then(y=>y.data),Fe=()=>Ce({queryKey:["client-expenses"],queryFn:ve}),Ye=()=>{var T,j;const[y,u]=d.useState(!1),[F,x]=d.useState(!1),{description:H,amount:U,date:Y,ContractId:$,values:k,handleInputChange:b,reset:w,updateAll:R}=ye({description:"",amount:0,date:new Date().toISOString().slice(0,10),ContractId:0}),[s,P]=d.useState(),[A,M]=d.useState(!1),[K,Q]=d.useState(""),[S,z]=d.useState({global:{value:null,matchMode:N.CONTAINS},description:{value:null,matchMode:N.CONTAINS},"Contract.Property.street":{value:null,matchMode:N.CONTAINS}}),m=d.useRef(),{showAndHideModal:i}=ie(),[I,p]=d.useState(!1),{data:n,isError:Z,isLoading:_,error:J,isFetching:W,refetch:D}=Fe(),X=xe(),ee=e=>{R({...e}),u(!0),M(!0),m.current=e},re=e=>{x(!F),m.current=e},te=e=>{const l=e;let o={...S};o.global.value=l,z(o),Q(l)},ae=async e=>{var l;try{p(!0);const o=await C.delete("/client-expenses/"+e);o.data.ok?(n!=null&&n.data&&(n.data=n==null?void 0:n.data.filter(c=>c.id!==e)),x(!1),i("Borrado",o.data.message)):i("Error",o.data.message||"Algo malo ocurrío.","red")}catch(o){o.response&&i("Error",((l=o.response.data)==null?void 0:l.message)||"Algo malo ocurrío.","red")}finally{p(!1)}},oe=async e=>{var c,h,f;e.preventDefault();const{error:l,ok:o}=ke({...k});if(P(l),!o)return!1;if(A)try{p(!0);const t=await C.put(`/client-expenses/${(c=m.current)==null?void 0:c.id}`,k);t.data.ok?(D(),w(),u(!1),i("Editado",t.data.message)):i("Error",t.data.message||"Algo malo ocurrío.","red")}catch(t){t.response&&i("Error",((h=t.response.data)==null?void 0:h.message)||"Algo malo ocurrío.","red")}finally{p(!1)}else try{p(!0);const t=await C.post("/client-expenses",k);t.data.ok?(D(),w(),u(!1),i("Guardado",t.data.message)):i("Error",t.data.message||"Algo malo ocurrío.","red")}catch(t){t.response&&i("Error",((f=t.response.data)==null?void 0:f.message)||"Algo malo ocurrío.","red")}finally{p(!1)}},E=()=>{w(),u(!1),P({})},se=e=>a("div",{className:"flex gap-x-3 items-center justify-center",children:[r(ue,{action:()=>ee(e)}),r(he,{action:()=>re(e)})]}),le=()=>{M(!1),m.current=null,u(!0)};return _?r(G,{}):Z?r(be,{error:J}):a("div",{className:"container m-auto  flex sm:mx-0  flex-col justify-center sm:justify-center",children:[r(de,{action:le,text:"Impuestos Inquilinos"}),n.data.length>0?a(ne,{children:[r(v,{onChange:e=>te(e),className:" w-auto mx-2 sm:mx-0 sm:w-96",initialValue:K,placeholder:"Buscar impuesto",type:"search"}),r(pe,{className:"!p-0 !overflow-hidden !border-none sm:mx-0    mb-4 ",children:a(ce,{size:"small",emptyMessage:"Aún no hay impuesto",className:"!overflow-hidden   !border-none",value:n==null?void 0:n.data,filters:S,globalFilterFields:["Contract.Property.street","description"],dataKey:"id",responsiveLayout:"scroll",children:[r(g,{field:"Contract.Property.street",body:e=>{var l,o,c,h,f,t,q,B;return a("span",{children:[(o=(l=e.Contract)==null?void 0:l.Property)==null?void 0:o.street," ",(h=(c=e.Contract)==null?void 0:c.Property)==null?void 0:h.number," ",(t=(f=e.Contract)==null?void 0:f.Property)==null?void 0:t.floor," ",(B=(q=e.Contract)==null?void 0:q.Property)==null?void 0:B.dept]})},header:"Propiedad",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),r(g,{field:"description",body:e=>a("span",{title:e.description,children:[e.description.slice(0,30)," ",e.description.length>30?"...":""]}),sortable:!0,header:"Descripción",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),r(g,{field:"amount",sortable:!0,header:"Monto",body:e=>a("span",{children:["$",e.amount]}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),r(g,{field:"date",sortable:!0,body:e=>r("span",{children:Ee(e.date)}),header:"Fecha",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),r(g,{body:se,headerClassName:"!border-none dark:!bg-gray-800",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",exportable:!1,style:{width:90}})]})})]}):r(we,{text:"Aún no hay Impuesto"}),W&&r(G,{h:40,w:40}),r(me,{show:F,savingOrUpdating:I,setShow:x,destroy:()=>{var e;return ae((e=m.current)==null?void 0:e.id)},text:`${(T=m.current)==null?void 0:T.description}`}),a(fe,{show:y,closeModal:E,overlayClick:!1,className:"max-w-[1000px] sm:w-[600px]",titleText:`${A?"Editar":"Agregar"} impuesto inquilino`,children:[r(Ne,{action:E}),a("form",{onSubmit:oe,children:[a(V,{children:[a("fieldset",{className:"w-full sm:!max-w-[400px] sm:w-[70%]",children:[r("label",{htmlFor:"ContractId",children:"Contrato "}),r(O,{value:$,onChange:e=>b(e.value,"ContractId"),options:(j=X.data)==null?void 0:j.data,optionLabel:"street",showClear:!0,valueTemplate:(e,l)=>e?a("span",{children:[" ",e.Client.fullName," | ",e.Property.street," ",e.Property.number," ",e.Property.floor,"-",e.Property.dept," "]}):l.placeholder,itemTemplate:e=>a("span",{children:[" ",e.Client.fullName," | ",e.Property.street," ",e.Property.number," ",e.Property.floor,"-",e.Property.dept," "]}),filterBy:"Client.fullName,Property.street,Property.number,Property.floor,Property.dept",optionValue:"id",placeholder:"elije contrato",filter:!0,filterPlaceholder:"Busca contrato",className:"h-[42px] items-center !border-gray-200 shadow sm:!max-w-[400px] "}),(s==null?void 0:s.ContractId)&&r(L,{text:"El contrato es obligatorio."})]}),r("div",{className:"w-full sm:w-[30%]",children:r(v,{placeholder:"123.99",initialValue:U||"",type:"number",onChange:e=>b(e,"amount"),label:"Monto",required:!0,hasError:s==null?void 0:s.amount,errorText:"El monto es obligatorio."})})]}),a(V,{children:[a("fieldset",{className:"w-full",children:[r("label",{htmlFor:"ContractId",children:"Descripción "}),r(O,{placeholder:"elije tipo de impuesto",value:H,options:["Seguro","Expensas","LUZ","GAS","AGUAS","TGI","API","Compensación"],onChange:e=>b(e.value,"description"),className:"h-[42px] items-center !border-gray-200 shadow ",required:!0}),(s==null?void 0:s.description)&&r(L,{text:"La descripción es obligatoria."})]}),r(v,{placeholder:"01/01/2023",type:"date",initialValue:Y,onChange:e=>b(e,"date"),label:"Fecha",required:!0,hasError:s==null?void 0:s.date,errorText:"La fecha es obligatoria."})]}),r(ge,{savingOrUpdating:I,onClose:E})]})]})]})};export{Ye as default};
