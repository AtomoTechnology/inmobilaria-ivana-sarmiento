import{h as P,r as c,f,j as a,L as R,a as l,F as pe}from"./index-3ed1fa78.js";import{u as fe,H as ge,D as be,C as u,a as Ce}from"./HeaderData-f8341142.js";import{B as ye}from"./Box-2f3a3966.js";import{E as Ne}from"./EditIcon-72ee5f20.js";import{D as xe}from"./DeleteIcon-e6cc714b.js";import{C as ke,F as Ee}from"./FormActionBtns-c23092d4.js";import{C as y}from"./CustomInput-6ca7ad9c.js";import{u as ve,F as Ie}from"./FormError-a3fab181.js";import{R as we,D as Ae}from"./RequestError-ce21148f.js";import{u as Me}from"./useContracts-759ab8e3.js";import{F as M}from"./FieldsetGroup-13ce1fee.js";import{C as Pe}from"./CustomTextArea-ed7f84a9.js";import{v as Se}from"./form-3a2308eb.js";import{E as Fe}from"./EmptyData-5a33961e.js";import{C as Te}from"./CloseOnClick-54123682.js";import{u as Le}from"./useQuery-6083f14c.js";import{B as Oe}from"./BoxContainerPage-d81583a3.js";const De=async()=>await P.get("/assurances").then(w=>w.data),Be=()=>Le({queryKey:["guarantors"],queryFn:De}),ea=()=>{var q,j,H;const[w,N]=c.useState(!1),[L,S]=c.useState(!1),{fullName:$,email:J,phone:K,cuit:_,address:W,obs:O,ContractId:X,values:x,handleInputChange:m,reset:F,updateAll:Y}=ve({fullName:"",email:"",phone:"",cuit:"",address:"",obs:"",ContractId:0}),[D,g]=c.useState(!1),[r,B]=c.useState(),[Z,G]=c.useState(!1),[z,ee]=c.useState(""),[V,ae]=c.useState({global:{value:null,matchMode:f.CONTAINS},email:{value:null,matchMode:f.CONTAINS},fullName:{value:null,matchMode:f.CONTAINS},cuit:{value:null,matchMode:f.CONTAINS},phone:{value:null,matchMode:f.CONTAINS},address:{value:null,matchMode:f.CONTAINS},"Contract.Property.street":{value:null,matchMode:f.CONTAINS}}),i=c.useRef(),{showAndHideModal:d}=fe(),{data:t,isError:re,isLoading:te,error:oe,isFetching:le,refetch:se}=Be(),b=Me(),ne=e=>{Y({...e}),N(!0),G(!0),i.current=e},de=e=>{S(!L),i.current=e},ie=e=>{const n=e;let s={...V};s.global.value=n,ae(s),ee(n)},ce=async e=>{var n;try{g(!0);const s=await P.delete("/assurances/"+e);s.data.ok?(t!=null&&t.data&&(t.data=t==null?void 0:t.data.filter(h=>h.id!==e)),S(!1),d("Borrado",s.data.message)):d("Error",s.data.message||"Algo malo ocurrío.","red")}catch(s){s.response&&d("Error",((n=s.response.data)==null?void 0:n.message)||"Algo malo ocurrío.","red")}finally{g(!1)}},ue=async e=>{var h,k,E;e.preventDefault();const{error:n,ok:s}=Se({...x},["obs"]);if(B(n),!s)return!1;if(Z)try{g(!0);const o=await P.put(`/assurances/${(h=i.current)==null?void 0:h.id}`,{...x});o.data.ok?(t!=null&&t.data&&(t.data=t==null?void 0:t.data.map(C=>{var v,I;return C.id===((v=i.current)==null?void 0:v.id)&&(C={...x,Contract:(I=b.data)==null?void 0:I.data.find(A=>A.id===x.ContractId)}),C})),F(),N(!1),d("Editado",o.data.message)):d("Error",o.data.message||"Algo malo ocurrío.","red")}catch(o){o.response&&d("Error",((k=o.response.data)==null?void 0:k.message)||"Algo malo ocurrío.","red")}finally{g(!1)}else try{g(!0);const o=await P.post("/assurances",{...x});o.data.ok?(se(),F(),N(!1),d("Guardado",o.data.message)):d("Error",o.data.message||"Algo malo ocurrío.","red")}catch(o){o.response&&d("Error",((E=o.response.data)==null?void 0:E.message)||"Algo malo ocurrío.","red")}finally{g(!1)}},T=()=>{F(),N(!1),B({})},me=e=>l("div",{className:"flex gap-x-3 items-center justify-center",children:[a(Ne,{action:()=>ne(e)}),a(xe,{action:()=>de(e)})]}),he=()=>{G(!1),i.current=null,N(!0)};return te?a(R,{}):re?a(we,{error:oe}):l(Oe,{children:[a(ge,{action:he,text:"Garantes"}),t.data.length>0?l(pe,{children:[a(y,{onChange:e=>ie(e),className:" w-auto mx-2 sm:mx-0 sm:w-96",initialValue:z,placeholder:"Buscar garante",type:"search"}),a(ye,{className:"!p-0 !overflow-hidden !border-none sm:mx-0  mb-4 ",children:l(be,{size:"small",emptyMessage:"Aún no hay garante",className:"!overflow-hidden   !border-none",value:t==null?void 0:t.data,filters:V,globalFilterFields:["Contract.Property.street","email","fullName","Contract.Property.number","cuit","phone","address"],dataKey:"id",responsiveLayout:"scroll",children:[a(u,{field:"ContractId",body:e=>{var n,s,h,k,E,o,C,v,I,A,Q,U;return l("span",{children:[(h=(s=(n=b.data)==null?void 0:n.data.find(p=>p.id===e.ContractId))==null?void 0:s.Property)==null?void 0:h.street," "," ",(o=(E=(k=b.data)==null?void 0:k.data.find(p=>p.id===e.ContractId))==null?void 0:E.Property)==null?void 0:o.number," "," ",(I=(v=(C=b.data)==null?void 0:C.data.find(p=>p.id===e.ContractId))==null?void 0:v.Property)==null?void 0:I.floor," ","",(U=(Q=(A=b.data)==null?void 0:A.data.find(p=>p.id===e.ContractId))==null?void 0:Q.Property)==null?void 0:U.dept]})},header:"Contrato",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(u,{field:"fullName",sortable:!0,header:"Nombre Completo",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(u,{field:"email",sortable:!0,header:"Email",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(u,{field:"cuit",sortable:!0,header:"CUIT/CUIL",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(u,{field:"phone",header:"Celular",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(u,{field:"address",header:"Dirección",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(u,{field:"obs",header:"Observaciones",body:e=>l("span",{className:"truncate",title:e.obs,children:[e.obs.slice(0,30)," ",e.obs.length>30&&"..."]}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(u,{body:me,headerClassName:"!border-none dark:!bg-gray-800",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",exportable:!1,style:{width:90}})]})})]}):a(Fe,{text:"Aún no hay garante"}),le&&a(R,{h:40,w:40}),a(Ce,{savingOrUpdating:D,show:L,setShow:S,destroy:()=>{var e;return ce((e=i.current)==null?void 0:e.id)},text:`${(q=i.current)==null?void 0:q.fullName} con email : ${(j=i.current)==null?void 0:j.email}`}),l(ke,{show:w,closeModal:T,overlayClick:!1,titleText:"Agregar  garante",className:"shadow-none border-0 max-w-[500px]",children:[a(Te,{action:T}),l("form",{onSubmit:ue,children:[a(M,{children:l("fieldset",{className:"",children:[a("label",{htmlFor:"ContractId",children:"Contrato "}),a(Ae,{value:X,onChange:e=>m(e.value,"ContractId"),options:(H=b.data)==null?void 0:H.data,optionLabel:"street",showClear:!0,valueTemplate:(e,n)=>e?l("span",{children:[" ",e.Client.fullName," | ",e.Property.street," ",e.Property.number," ",e.Property.floor,"-",e.Property.dept," "]}):n.placeholder,itemTemplate:e=>l("span",{children:[" ",e.Client.fullName," | ",e.Property.street," ",e.Property.number," ",e.Property.floor,"-",e.Property.dept," "]}),filterBy:"Client.fullName,Property.street,Property.number,Property.floor,Property.dept",optionValue:"id",placeholder:"elije contrato",filter:!0,filterPlaceholder:"Busca contrato",className:"h-[42px] items-center !border-gray-200 shadow "}),(r==null?void 0:r.ContractId)&&a(Ie,{text:"El contrato es obligatorio."})]})}),l(M,{children:[a(y,{placeholder:"Juan Jose",initialValue:$||"",onChange:e=>m(e,"fullName"),maxLength:100,label:"Nombre Completo",required:!0,hasError:r==null?void 0:r.fullName,errorText:"El nombre es obligatorio."}),a(y,{placeholder:"example@gmail.com",initialValue:J||"",type:"email",onChange:e=>m(e,"email"),maxLength:150,label:"Email",required:!0,hasError:r==null?void 0:r.email,errorText:"El correo es obligatorio."})]}),l(M,{children:[a(y,{placeholder:"20-20202020-0",initialValue:_||"",onChange:e=>m(e,"cuit"),maxLength:15,label:"Cuit/Cuil",required:!0,hasError:r==null?void 0:r.cuit,errorText:"El cuit/cuil es obligatorio."}),a(y,{placeholder:"3412002020",initialValue:K||"",onChange:e=>m(e,"phone"),maxLength:20,label:"Teléfono",required:!0,hasError:r==null?void 0:r.phone,errorText:"El teléfono es obligatorio."})]}),a(M,{children:a(y,{placeholder:"Sarmiento 1247",initialValue:W||"",onChange:e=>m(e,"address"),maxLength:100,label:"Dirección",required:!0,hasError:r==null?void 0:r.address,errorText:"La dirección es obligatoria."})}),l("div",{className:"flex flex-col justify-between",children:[a(Pe,{placeholder:"Escribe una observación o nota de algo...",initialValue:O||"",onChange:e=>m(e,"obs"),optional:!0,maxLength:255,label:"Observación"}),l("div",{className:"items-end self-end",children:[O.length,"/255"]})]}),a(Ee,{savingOrUpdating:D,onClose:T})]})]})]})};export{ea as default};
