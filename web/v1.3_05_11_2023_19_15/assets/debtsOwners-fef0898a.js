import{r as d,f as y,j as a,L as O,a as t,F as oe,h as P}from"./index-3ed1fa78.js";import{u as le,H as de,D as T,C as s,a as ne}from"./HeaderData-f8341142.js";import{B as ie}from"./Box-2f3a3966.js";import{C as $}from"./CustomInput-6ca7ad9c.js";import{R as ce}from"./RequestError-ce21148f.js";import{u as me}from"./useContracts-759ab8e3.js";import{f as h,e as B}from"./date-8ced1934.js";import{E as ue}from"./EmptyData-5a33961e.js";import{D as be}from"./DeleteIcon-e6cc714b.js";import{u as he}from"./FormError-a3fab181.js";import{v as pe}from"./form-3a2308eb.js";import{C as ge,F as fe}from"./FormActionBtns-c23092d4.js";import{C as ke}from"./CloseOnClick-54123682.js";import{E as xe}from"./EditIcon-72ee5f20.js";import"./useQuery-6083f14c.js";const $e=()=>{var E,M,A,F;const[H,j]=d.useState(""),[N,L]=d.useState({global:{value:null,matchMode:y.CONTAINS},"Client.fullName":{value:null,matchMode:y.CONTAINS},"PropertyType.description":{value:null,matchMode:y.CONTAINS}}),[R,q]=d.useState(),{data:l,isError:Y,isLoading:V,error:z,isFetching:U,refetch:G}=me("/debts/owner/all"),[C,p]=d.useState(!1),{showAndHideModal:i}=le(),n=d.useRef(),[w,g]=d.useState(!1),[K,D]=d.useState(!1),[f,v]=d.useState(),{values:k,amount:x,id:S,reset:_,handleInputChange:J,updateAll:Q}=he({id:0,amount:0,ContractId:0}),W=e=>{const r=e;let o={...N};o.global.value=r,L(o),j(r)},X=e=>{p(!C),n.current=e},Z=e=>{Q({amount:e.amount,id:e.id,ContractId:e.ContractId}),D(!0),n.current=e},u=()=>{_(),D(!1),v({}),n.current=null},ee=async e=>{var b,I;e.preventDefault();const{error:r,ok:o}=pe({...k});if(v(r),!o)return!1;try{const c=await P.put("/debt-owners/"+S,{amount:x});c.data.ok?((b=l==null?void 0:l.data)==null||b.filter(m=>m.id===k.ContractId)[0].DebtOwners.map(m=>(m.id===S&&m.ContractId===k.ContractId&&(m.amount=x),m)),u(),i("Actualizado",c.data.message)):i("Error",c.data.message||"Algo malo ocurrío.","red")}catch(c){c.response&&i("Error",((I=c.response.data)==null?void 0:I.message)||"Algo malo ocurrío.","red")}finally{g(!1)}},ae=async e=>{var r;try{g(!0);const o=await P.delete("/debt-owners/"+e);o.data.ok?(G(),p(!1),i("Borrado",o.data.message)):i("Error",o.data.message||"Algo malo ocurrío.","red")}catch(o){o.response&&i("Error",((r=o.response.data)==null?void 0:r.message)||"Algo malo ocurrío.","red")}finally{g(!1)}},re=e=>t("div",{className:"flex gap-x-3 items-center justify-center",children:[a(xe,{action:()=>Z(e)}),a(be,{action:()=>X(e)})]}),te=e=>(e==null?void 0:e.DebtOwners.length)>0||!1,se=e=>t("div",{className:"p-3",children:[a("h2",{className:"text-lg font-semibold",children:"Histórico de deudas"}),t(T,{size:"small",dataKey:"id",className:"!overflow-hidden   !border-none",responsiveLayout:"scroll",value:e.DebtOwners,children:[a(s,{field:"amount",body:r=>t("span",{children:[" $",r.amount," "]}),header:"Monto",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{header:"Periodo",field:"month",body:r=>t("span",{children:[r.month,"/",r.year," "]}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",field:"createdAt",body:r=>t("span",{children:[" ",h(r.createdAt.slice(0,10))," "]}),header:"Fecha creación",sortable:!0}),a(s,{header:"Descripción",field:"description",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(s,{headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",field:"paid",sortable:!0,body:r=>t("span",{className:`p-1 rounded-full px-2  ${r.paid?"text-green-400":"text-red-400"}`,children:[" ",r.paid?"Pagado":"Sin pagar"," ",r.paid&&h(r.paidDate.slice(0,10))," "]}),header:"Pago"}),a(s,{body:re,headerClassName:"!border-none dark:!bg-gray-800",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",exportable:!1,style:{width:90}})]})]});return V?a(O,{}):Y?a(ce,{error:z}):t("div",{className:"container m-auto  flex sm:mx-0  flex-col justify-center sm:justify-center",children:[a(de,{showBtn:!1,action:()=>{},text:"Deudas x propietarios"}),((E=l==null?void 0:l.data)==null?void 0:E.length)>0?t(oe,{children:[a($,{onChange:e=>W(e),className:" w-auto mx-2 sm:mx-0 sm:w-96",initialValue:H,placeholder:"Buscar contrato",type:"search"}),a(ie,{className:"!p-0 !overflow-hidden !border-none sm:mx-0    mb-4 ",children:t(T,{expandedRows:R,onRowToggle:e=>q(e.data),rowExpansionTemplate:se,size:"small",emptyMessage:"Aún no hay contrato",className:"!overflow-hidden   !border-none",value:l==null?void 0:l.data,filters:N,globalFilterFields:["Property.street","Client.fullName"],dataKey:"id",responsiveLayout:"scroll",children:[a(s,{expander:te,headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",style:{width:"0.5rem"}}),a(s,{field:"Property.street",body:e=>t("span",{className:`${e.DebtOwners.filter(r=>!r.paid).length>0?"text-red-400":""}`,children:[e.Property.street," ",e.Property.number," ",e.Property.floor," ",e.Property.dept]}),header:"Propiedad",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"Property.folderNumber",header:"Carpeta",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"Client.fullName",body:e=>t("span",{className:`${e.DebtOwners.filter(r=>!r.paid).length>0?"text-red-400":""}`,children:[e.Client.fullName," ",t("span",{className:"text-sm",children:[" (",e.Client.cuit,") "]})]}),header:"Inquilino",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"startDate",header:"Fecha inicio",body:e=>a("span",{children:h(e.startDate)}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"endDate",header:"Fecha fin",body:e=>a("span",{children:h(e.endDate)}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),a(s,{field:"state",header:"Estado",sortable:!0,body:e=>a("span",{children:e.state}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(s,{field:"state",header:"Año",body:e=>a("span",{className:`${B(e.startDate,new Date().toISOString().slice(0,10))===3&&"text-yellow-500 font-bold"}`,children:B(e.startDate,new Date().toISOString().slice(0,10))}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),a(s,{field:"",header:"Monto Actual",body:e=>{var r;return t("span",{className:"font-bold",children:["$",(r=e.PriceHistorials.sort((o,b)=>o.id-b.id)[e.PriceHistorials.length-1])==null?void 0:r.amount]})},headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "})]})})]}):a(ue,{text:"Aún no hay deuda"}),U&&a(O,{h:40,w:40}),a(ne,{show:C,setShow:p,savingOrUpdating:w,destroy:()=>{var e;return ae((e=n.current)==null?void 0:e.id)},text:`La deuda del periodo ${(M=n.current)==null?void 0:M.month}/${(A=n.current)==null?void 0:A.year} de  monto   $ ${(F=n.current)==null?void 0:F.amount}`}),t(ge,{show:K,closeModal:u,overlayClick:!1,className:"max-w-[1000px] sm:w-[600px]",titleText:"Editar deuda inquilino",children:[a(ke,{action:u}),t("form",{onSubmit:ee,children:[a($,{placeholder:"1234.90",type:"number",initialValue:x,onChange:e=>J(e,"amount"),label:"Monto",required:!0,hasError:f==null?void 0:f.amount,errorText:"El monto es requerido"}),a(fe,{savingOrUpdating:w,onClose:u})]})]})]})};export{$e as default};
