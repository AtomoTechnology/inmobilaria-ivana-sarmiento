import{h as I,G as _t,a4 as ne,r as c,f as v,j as t,L as Ee,a,F as st,ac as zt,a6 as Wt,a7 as Kt,a3 as Me}from"./index-3ed1fa78.js";import{u as Jt,H as Xt,D as Zt,C as O,a as ea}from"./HeaderData-f8341142.js";import{B as k}from"./Box-2f3a3966.js";import{C as ot,F as ta}from"./FormActionBtns-c23092d4.js";import{C as Fe}from"./CustomInput-6ca7ad9c.js";import{u as aa,F as it}from"./FormError-a3fab181.js";import{R as ra,D as re}from"./RequestError-ce21148f.js";import{F as A}from"./FieldsetGroup-13ce1fee.js";import{u as la}from"./useContracts-759ab8e3.js";import{u as na}from"./usePaymentTypes-eca79a45.js";import{C as he,T as sa}from"./index.esm-a0238907.js";import{C as dt}from"./CloseOnClick-54123682.js";import{u as oa}from"./useQuery-6083f14c.js";import{f as T,g as ia,d as le,p as ct}from"./date-8ced1934.js";import{h as da}from"./html2pdf-c13131c9.js";import{v as ca}from"./form-3a2308eb.js";import{E as ma}from"./EmptyData-5a33961e.js";import{C as ua}from"./CustomTextArea-ed7f84a9.js";import{r as u}from"./numbers-1d12c913.js";import{D as mt}from"./DropDownIcon-494d3a2b.js";const pa=async()=>{const{data:B}=await I.get("/payment-clients?sort=id:desc");return B},ha=()=>oa({queryKey:["payment-clients"],queryFn:pa});function $e(B){return _t({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}},{tag:"line",attr:{x1:"12",y1:"9",x2:"12",y2:"13"}},{tag:"line",attr:{x1:"12",y1:"17",x2:"12.01",y2:"17"}}]})(B)}const ut={extraExpenses:0,ContractId:null,PaymentTypeId:null,month:ne[new Date().getMonth()],year:new Date().getFullYear(),total:0,recharge:0,qteDays:0,dailyPunitive:0,PropertyId:null,paidTotal:0,obs:""},Ba=()=>{var We,Ke,Je,Xe,Ze,et,tt,at,rt;const[B,je]=c.useState(!1),[pt,Oe]=c.useState(!1),[Be,fe]=c.useState(!1),{ContractId:p,PaymentTypeId:ht,recharge:w,month:S,year:E,paidTotal:L,updateAll:R,total:fa,values:h,qteDays:Le,handleInputChange:q,reset:ft,dailyPunitive:Re,obs:gt}=aa(ut),{showAndHideModal:M}=Jt(),[qe,se]=c.useState(!1),[y,He]=c.useState(),[ga,bt]=c.useState(!1),[yt,Ge]=c.useState(!1),[oe,ge]=c.useState([]),[f,be]=c.useState([]),[Q,ye]=c.useState([]),[Ue,xe]=c.useState(!1),[xt,Ne]=c.useState(!1),[Nt,Ce]=c.useState(!1),[Ct,ve]=c.useState(0),[D,ke]=c.useState(0),we=c.useRef(0),[n,Pe]=c.useState({}),x=c.useRef(0),N=c.useRef(0),C=c.useRef(0),o=c.useRef(),[Qe,Se]=c.useState([]),[Ve,De]=c.useState([]),[Ae,ie]=c.useState([]),[Te,Ye]=c.useState(!1),[vt,kt]=c.useState({global:{value:null,matchMode:v.CONTAINS},month:{value:null,matchMode:v.EQUALS},year:{value:null,matchMode:v.EQUALS},"Contract.Client.fullName":{value:null,matchMode:v.STARTS_WITH},createdAt:{value:null,matchMode:v.EQUALS},"PaymentType.name":{value:null,matchMode:v.EQUALS}}),[wt,Ie]=c.useState(!1),[F,_e]=c.useState([]),V=na(),{data:b,isError:Pt,isLoading:St,error:Dt,isFetching:At,refetch:Tt}=ha(),ze=la("?state=Finalizado:ne"),It=async e=>{o.current=e,Oe(!0)},Et=()=>{kt({global:{value:null,matchMode:v.CONTAINS},month:{value:null,matchMode:v.EQUALS},year:{value:null,matchMode:v.EQUALS},"Contract.Client.fullName":{value:null,matchMode:v.STARTS_WITH},createdAt:{value:null,matchMode:v.EQUALS},"PaymentType.name":{value:null,matchMode:v.EQUALS}})},de=()=>{Oe(!1),o.current=null},Mt=async()=>{var l,i,d;Ye(!0);var e=document.getElementById("pdf-download"),r={margin:[.1,.1],filename:`${(l=o.current)==null?void 0:l.Contract.Client.fullName}_${(i=o.current)==null?void 0:i.month}_${(d=o.current)==null?void 0:d.year}_${T(new Date().toISOString())}.pdf`,image:{type:"png",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"landscape"}};try{await da().from(e).set(r).save()}catch(m){console.log(m)}finally{Ye(!1),de()}},Ft=e=>{fe(!Be),o.current=e},$t=async e=>{var r;try{se(!0);const l=await I.delete("/payment-clients/"+e);l.data.ok?(b!=null&&b.data&&(b.data=b==null?void 0:b.data.filter(i=>i.id!==e)),fe(!1),M("Borrado",l.data.message)):M("Error",l.data.message||"Algo malo ocurrío.","red")}catch(l){l.response&&M("Error",((r=l.response.data)==null?void 0:r.message)||"Algo malo ocurrío.","red")}finally{se(!1)}},jt=async e=>{var i;e.preventDefault(),h.total=n.checked?Number(Number(n.amount)+D+x.current+N.current+C.current+(f.filter(d=>d.paidCurrentMonth).length>0?w:0)):x.current+D+N.current+C.current+(f.filter(d=>d.paidCurrentMonth).length>0?w:0),h.total=u(h.total),f.filter(d=>d.paidCurrentMonth).length>0?h.recharge=u(h.qteDays*h.dailyPunitive):h.recharge=0;const{error:r,ok:l}=ca({...h},["paidTotal","extraExpenses","qteDays","recharge","dailyPunitive","obs","PropertyId"]);if(He(r),!l)return!1;try{se(!0);let d=n.checked?[...f,...Q,n]:[...f,...Q];D>0&&d.push({id:new Date().getTime(),description:"Gastos Bancarios",amount:D,isBankExpense:!0,createdAt:new Date().toISOString()});const m=await I.post("/payment-clients",{...h,ContractId:h.ContractId.id,expenseDetails:d,eventualityDetails:oe});m.data.ok?(Tt(),ft(),ce(),M("Guardado",m.data.message)):M("Error",m.data.message||"Algo malo ocurrío.","red")}catch(d){d.response&&M("Error",((i=d.response.data)==null?void 0:i.message)||"Algo malo ocurrío.","red")}finally{se(!1)}},ce=()=>{R({...ut,ContractId:null}),xe(!1),Ne(!1),Ce(!1),ge([]),be([]),De([]),Se([]),ie([]),ye([]),x.current=0,N.current=0,C.current=0,je(!1),He({})},Ot=e=>a("div",{className:"flex gap-x-3 items-center justify-center",children:[t(Kt,{title:"Imprimir comprobante",size:22,onClick:()=>It(e)}),t(sa,{title:"Revertir cobro",size:23,onClick:()=>Ft(e)})]}),Bt=e=>{let r=[...f];e.value.paidCurrentMonth&&q(u(Number(h.dailyPunitive)*Number(h.qteDays)),"recharge"),e.checked?r.push(e.value):r=r.filter(l=>l.id!==e.value.id),N.current=u(r.reduce((l,i)=>l+i.amount,0)),be(r)},Lt=e=>{let r=[...Q];if(e.checked){if(r.push(e.value),e.value.rent&&confirm("Deseas cobrar los punitorias ?")===!0){let l=Ae.find(i=>i.debtParentId===e.value.id);r.push(l)}}else r=r.filter(l=>l.id!==e.value.id),e.value.rent&&(r=r.filter(l=>(l==null?void 0:l.debtParentId)!==e.value.id));C.current=u(r.reduce((l,i)=>l+i.amount,0)),ye(r)},Rt=e=>{let r=[...oe];e.checked?r.push(e.value):r=r.filter(l=>l.id!==e.value.id),x.current=u(r.reduce((l,i)=>l+i.clientAmount,0)),ge(r)},qt=async e=>{var l,i,d,m,Y,_,z,W,K,J,X,Z,ee,te,ae;if(Ie(!0),xe(!1),Ne(!1),Ce(!1),ge([]),be([]),De([]),Se([]),ie([]),ve(2),ye([]),_e([]),x.current=0,N.current=0,C.current=0,ke(0),Ge(!1),e.value==null){R({...h,ContractId:null,paidTotal:0,PaymentTypeId:null});return}ve(e.value.admFeesPorc),h.ContractId=e.value;let r=le(e.value.startDate,new Date().toISOString().slice(0,10));r>=365&&r<730?e.value.PriceHistorials.length<2&&Ne(!0):r>=730&&e.value.PriceHistorials.length<3&&Ce(!0);try{const P=await I.get(`/payment-clients?ContractId=${e.value.id}&month=${S}&year=${E}&include=true`);P.data.results>0&&(P.data.data.map(H=>_e(G=>[...G,...H.expenseDetails])),xe(!0),R({...h,ContractId:e.value,PropertyId:e.value.PropertyId,total:0,recharge:0,qteDays:0,PaymentTypeId:null,paidTotal:0}))}catch{M("Error","Error al intentar validar si el contrato ya tiene cobro para el mes y ano actual","red")}try{Ie(!0);const P=I.get(`/client-expenses?amount=0:gt&ContractId=${e.value.id}&include=true`),H=I.get(`/eventualities?clientPaid=0&PropertyId=${e.value.PropertyId}&clientAmount=0:ne&include=true`),G=I.get("/config?key=punitorio_diario,gastos_bancarios:or"),me=I.get(`/debt-clients?paid=0&ContractId=${e.value.id}`),[ue,$,U,lt]=await Promise.all([P,H,G,me]);let pe=Number((l=U.data.data.find(s=>s.key==="punitorio_diario"))==null?void 0:l.value);le(new Date(2023,7,31).toISOString().slice(0,10),e.value.startDate)>0&&((i=e.value.PriceHistorials.sort((s,g)=>s.id-g.id)[e.value.PriceHistorials.length-1])==null?void 0:i.amount)>=85e3?we.current=u(((d=e.value.PriceHistorials.sort((s,g)=>s.id-g.id)[e.value.PriceHistorials.length-1])==null?void 0:d.amount)/100):we.current=Number((m=U.data.data.find(s=>s.key==="gastos_bancarios"))==null?void 0:m.value),De($.data.data),le(new Date().toISOString().slice(0,10),e.value.endDate)>0?(Se([{ContractId:e.value.id,date:new Date().toISOString().slice(0,10),updatedAt:new Date().toISOString(),deletedAt:null,description:"ALQUILER "+e.value.Property.street+" "+((_=(Y=e.value)==null?void 0:Y.Property)==null?void 0:_.number)+" "+((W=(z=e.value)==null?void 0:z.Property)==null?void 0:W.floor)+" "+((J=(K=e.value)==null?void 0:K.Property)==null?void 0:J.dept)+" "+S+"/"+E,amount:(X=e.value.PriceHistorials.sort((s,g)=>s.id-g.id)[e.value.PriceHistorials.length-1])==null?void 0:X.amount,createdAt:new Date().getTime().toString(),paidCurrentMonth:!0,id:Me()},...ue.data.data.filter(s=>{if(s.description!=="AGUAS"&&s.description!=="API")return s;if(s.description==="AGUAS"&&(new Date().getMonth()+1)%2===0||s.description==="API"&&(new Date().getMonth()+1)%2!==0)return s}).map(s=>({...s,description:s.description+" "+S+"/"+E}))]),Pe({ContractId:e.value.id,date:new Date().toISOString().slice(0,10),updatedAt:new Date().toISOString(),deletedAt:null,description:"GASTOS DE GESTION "+S+"/"+E,amount:u(e.value.admFeesPorc/100*((Z=e.value.PriceHistorials.sort((s,g)=>s.id-g.id)[e.value.PriceHistorials.length-1])==null?void 0:Z.amount)),createdAt:new Date().getTime().toString(),id:Me(),checked:!1})):Ge(!0),ie(lt.data.data),lt.data.data.map(s=>{if(s.rent){let g=le(s.year+"-"+ct(s.month)+"-05",new Date().toString());ie(j=>[...j,{...s,description:"PUNITORIOS "+s.description,amount:u(g*s.amount*(pe/100)),createdAt:new Date().getTime().toString(),rent:!1,debtParentId:s.id,debt:!1,id:Me(),recharge:!0}])}});let nt=new Date().getDate();if(nt>5){let s=nt-5;R({...h,PropertyId:e.value.PropertyId,recharge:u(s*((ee=e.value.PriceHistorials.sort((g,j)=>g.id-j.id)[e.value.PriceHistorials.length-1])==null?void 0:ee.amount)*(pe/100)),qteDays:s,ContractId:e.value,PaymentTypeId:null,paidTotal:0,dailyPunitive:((te=e.value.PriceHistorials.sort((g,j)=>g.id-j.id)[e.value.PriceHistorials.length-1])==null?void 0:te.amount)*(pe/100),total:u(s*((ae=e.value.PriceHistorials.sort((g,j)=>g.id-j.id)[e.value.PriceHistorials.length-1])==null?void 0:ae.amount)*(pe/100))})}else R({...h,ContractId:e.value,PropertyId:e.value.PropertyId,PaymentTypeId:null,paidTotal:0})}catch{}finally{Ie(!1)}},Ht=()=>{bt(!1),o.current=null,je(!0)},Gt=e=>t(k,{className:"!m-0 !p-0",children:t(re,{value:e.value,onChange:r=>e.filterApplyCallback(r.value),options:ne,showClear:!0,placeholder:"elije mes",className:"h-[42px]   items-center w-full !border-gray-200 shadow "})}),Ut=e=>t(k,{className:"!m-0 !p-0",children:t(Fe,{initialValue:e.value??"",onChange:r=>e.filterApplyCallback(r),type:"date",placeholder:"elije fecha",fieldsetClassName:"!mt-0"})}),Qt=e=>{var r;return t(k,{className:"!m-0 !p-0",children:t(re,{value:e.value??"",onChange:l=>e.filterApplyCallback(l.value),options:(r=V==null?void 0:V.data)==null?void 0:r.data,optionLabel:"name",showClear:!0,optionValue:"name",placeholder:"elije format de pago",className:"h-[42px]   items-center w-full !border-gray-200 shadow "})})},Vt=e=>{var r;return t(k,{className:"!m-0 !p-0",children:t(re,{value:e.value??"",onChange:l=>e.filterApplyCallback(l.value),options:(r=ze.data)==null?void 0:r.data,optionLabel:"Client.fullName",showClear:!0,filterBy:"Client.fullName",optionValue:"Client.fullName",placeholder:"elije contrato",filter:!0,filterPlaceholder:"Busca contrato",className:"h-[42px]   items-center w-60 !border-gray-200 shadow "})})},Yt=e=>{const r=new Set,l=new Set,i=e.expenseDetails.filter(m=>m.hasOwnProperty("debt")).map(m=>({month:m.month,year:m.year})),d=e.expenseDetails.filter(m=>m.hasOwnProperty("paidCurrentMonth"));return i.length>0&&i.forEach(m=>{r.add(m.month),l.add(m.year)}),(d.length>0||i.length===0&&d.length===0)&&(r.add(ne.findIndex(m=>m===e.month)+1),l.add(e.year)),a("span",{children:[Array.from(r).map(m=>ne[m-1]).join("-"),"/",Array.from(l).join("-")]})};return St?t(Ee,{}):Pt?t(ra,{error:Dt}):a("div",{className:"container m-auto  flexsm:mx-0  flex-col justify-center sm:justify-center",children:[t(Xt,{action:Ht,text:"Cobro a Inquilino"}),(b==null?void 0:b.data.length)>0?a(st,{children:[t("button",{className:"btn dark:bg-transparent dark:text-slate-400 dark:border hover:!text-slate-500 active:text-slate-500 border-slate-700 ",onClick:Et,children:"Borrar filtros"}),t(k,{className:"!p-0 !overflow-hidden !border-none sm:mx-0    mb-4 ",children:a(Zt,{size:"small",emptyMessage:"No hay cobro para ese filtro",className:"!overflow-hidden   !border-none",value:b==null?void 0:b.data,dataKey:"id",filters:vt,filterDisplay:"menu",globalFilterFields:["month","year","Contract.Property.street","Contract.Client.fullName","ContractId","PaymentType.name"],responsiveLayout:"scroll",children:[t(O,{field:"Contract.Client.fullName",body:e=>{var r;return t("span",{children:(r=e.Contract)==null?void 0:r.Client.fullName})},header:"Inquilino",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0,filter:!0,filterMenuClassName:"!bg-gray-100 dark:!bg-slate-700 dark:!text-slate-400 dark:!border-slate-600",showClearButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterElement:Vt}),t(O,{field:"Contract.Property.street",body:e=>{var r,l,i,d;return a("span",{children:[(r=e.Contract)==null?void 0:r.Property.street," ",(l=e.Contract)==null?void 0:l.Property.number," ",(i=e.Contract)==null?void 0:i.Property.floor," ",(d=e.Contract)==null?void 0:d.Property.dept]})},header:"Propiedad",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),t(O,{field:"month",body:Yt,header:"Periodo",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0,filter:!0,filterMenuClassName:"!bg-gray-100 dark:!bg-slate-700 dark:!text-slate-400 dark:!border-slate-600",showClearButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterElement:Gt}),t(O,{field:"createdAt",body:e=>t("span",{children:T(e.createdAt)}),header:"Fecha de Cobro",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0,filter:!0,filterMenuClassName:"!bg-gray-100 dark:!bg-slate-700 dark:!text-slate-400 dark:!border-slate-600",showClearButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterElement:Ut}),t(O,{field:"total",body:e=>t("span",{children:e.paidTotal>0?a("span",{className:"flex items-center",children:["   $",u(e.paidTotal)," ",t(zt,{title:`Pago parcial. Total :: ${e.total}`,size:15,className:"dark:text-yellow-300  text-yellow-400 ml-1"})," "]}):"$"+u(e.total)}),header:"Total Cobrado",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),t(O,{field:"PaymentType.name",header:"Format de pago",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0,filter:!0,filterMenuClassName:"!bg-gray-100 dark:!bg-slate-700 dark:!text-slate-400 dark:!border-slate-600",showClearButton:!1,showFilterMatchModes:!1,showApplyButton:!1,filterElement:Qt}),t(O,{body:Ot,headerClassName:"!border-none dark:!bg-gray-800",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",exportable:!1,style:{width:90}})]})})]}):t(ma,{text:"Aún no hay Cobro"}),At&&t(Ee,{h:40,w:40}),t(ea,{show:Be,savingOrUpdating:qe,setShow:fe,customTitle:"Revertir Cobro",customMessage:`¿Estás seguro que querés revertir el cobro de ${(We=o.current)==null?void 0:We.Contract.Client.fullName} ${(Ke=o.current)==null?void 0:Ke.month}/${(Je=o.current)==null?void 0:Je.year}?`,destroy:()=>{var e;return $t((e=o.current)==null?void 0:e.id)}}),a(ot,{show:pt,closeModal:de,overlayClick:!1,className:"shadow-none border-0   w-fit max-w-5xl !p-3",titleText:`Recibo  ${(Xe=o.current)==null?void 0:Xe.month}/${(Ze=o.current)==null?void 0:Ze.year}`,children:[t(dt,{action:de}),a(k,{className:"!shadow-none rounded-lg !p-2 !border-none  border-gray-200 dark:!from-gray-700 dark:!to-gray-800 dark:!bg-gradient-to-tr mt-3",children:[t("div",{id:"pdf-download",className:"flex gap-x-2 ",children:[1,2].map((e,r)=>{var l,i,d,m,Y,_,z,W,K,J,X,Z,ee,te,ae,P,H,G,me,ue;return a("div",{className:"flex justify-between flex-col border border-gray-200 dark:border-slate-600 p-1 text-xs  min-h-[750px] ] !w-[550px]",children:[a("div",{className:"header-pdf flex items-center justify-between border border-gray-200 dark:border-slate-600  p-2",children:[a("div",{className:"left w-[50%] flex items-center flex-col gap-y-2",children:[t("div",{className:"logo-app flex items-center",children:t("img",{width:60,className:"min-w-[60px] object-cover",src:Wt,alt:"LOGO CENTRO"})}),a("div",{className:"flex flex-col items-center",children:[t("span",{className:"text-lg font-semibold uppercase",children:"Centro"}),t("span",{className:"text-md font-semibold ",children:"Administracion de  "}),t("span",{className:"text-xs  ",children:"Consorcios y Propiedades"})]})]}),t("div",{className:"right w-[50%] ",children:a("div",{className:"flex flex-col items-center text-xs",children:[t("span",{children:"Alquileres - Ventas - Tasaciones"}),t("span",{children:"San Martin 1514  Tel: 4483280"}),t("span",{children:"2000 - Rosario - Santa Fe "}),t("span",{children:"inmobiliaria.centro.1980@gmail.com"}),t("span",{children:"www.centro.com.ar"}),t("div",{className:"",children:a("span",{className:"flex gap-x-2",children:[t("span",{children:"Rosario"}),t("span",{children:T(new Date().toISOString())})]})})]})})]}),a("div",{className:"client-data border border-gray-200 dark:border-slate-600  my-2 p-2 flex ",children:[a("div",{className:"flex flex-col gap-y-2 flex-1",children:[a("span",{children:[t("span",{className:"font-semibold",children:"Inquilino: "}),t("span",{children:(l=o.current)==null?void 0:l.Contract.Client.fullName})]}),a("span",{children:[t("span",{className:"font-semibold",children:"Domicilio: "}),t("span",{children:(i=o.current)==null?void 0:i.Contract.Client.address})]})]}),a("div",{className:"w-30  flex gap-x-4",children:[a("div",{className:"",children:[a("div",{children:["C ",(d=o.current)==null?void 0:d.Contract.Property.folderNumber," "]}),t("div",{className:"",children:a("span",{className:"flex gap-x-2",children:[t("span",{children:"Recibo"}),t("span",{className:"",children:ia(((m=o.current)==null?void 0:m.id)||0,4)})]})})]}),a("div",{className:"flex flex-col  items-center",children:[t("span",{className:"font-semibold",children:"Vencimiento"}),t("span",{className:"font-semibold",children:"del contrato"}),a("span",{className:"!text-xs ",children:[T((Y=o.current)==null?void 0:Y.Contract.startDate)," "," / ",T((_=o.current)==null?void 0:_.Contract.endDate)]})]})]})]}),a("div",{className:"payment-pdf px-2 mb-3 flex-1 gap-y-1 flex flex-col font-normal ",children:[(z=o.current)==null?void 0:z.expenseDetails.map(($,U)=>a("div",{className:"align-items-center uppercase  text-xs  flex gap-x-3 items-center  justify-between dark:border-slate-600     border-gray-300",children:[t("span",{className:"",children:$.description}),a("span",{children:["$",$.amount]})]},U)),((W=o.current)==null?void 0:W.recharge)>0&&a("div",{className:"align-items-center uppercase text-xs  flex gap-x-3 items-center  justify-between dark:border-slate-600    border-gray-300",children:[a("span",{className:"",children:["PUNITORIOS  ",(K=o.current)==null?void 0:K.month,"   ",(J=o.current)==null?void 0:J.year.toString()]}),a("span",{children:["$",(X=o.current)==null?void 0:X.recharge]})]}),(Z=o.current)==null?void 0:Z.eventualityDetails.map(($,U)=>a("div",{className:"align-items-center uppercase text-xs  flex gap-x-3 items-center  justify-between dark:border-slate-600     border-gray-300",children:[t("span",{className:"",children:$.description}),a("span",{children:["$",$.clientAmount]})]},U)),((ee=o.current)==null?void 0:ee.obs)&&a("div",{className:"text-xs border p-1 pb-2 mt-1 dark:border-slate-600     border-gray-300",children:[t("span",{className:"",children:"Observaciones : "}),t("span",{children:(te=o.current)==null?void 0:te.obs})]})]}),a("div",{className:"mt-auto p-2 font-normal border border-gray-200 dark:border-slate-600 ",children:[a("div",{className:"align-items-center   text-xs  flex gap-x-3 items-center  justify-between dark:border-slate-600     border-gray-300",children:[t("span",{className:"",children:"Total  "}),a("span",{className:"",children:["$",u((ae=o.current)==null?void 0:ae.total)]})]}),((P=o.current)==null?void 0:P.paidTotal)>0&&a(st,{children:[a("div",{className:"align-items-center   text-xs  flex gap-x-3 items-center  justify-between dark:border-slate-600     border-gray-300",children:[t("span",{className:"",children:"Total cobrado  "}),a("span",{className:"",children:["$",u((H=o.current)==null?void 0:H.paidTotal)]})]}),a("div",{className:"align-items-center   text-xs  flex gap-x-3 items-center  justify-between dark:border-slate-600     border-gray-300",children:[t("span",{className:"",children:"Diferencia "}),a("span",{className:"",children:["$",u((G=o.current)==null?void 0:G.total)-u((me=o.current)==null?void 0:me.paidTotal)]})]})]}),a("div",{className:"align-items-center   text-xs  flex gap-x-3 items-center  justify-between dark:border-slate-600     border-gray-300",children:[t("span",{className:"",children:"Format de pago  "}),t("span",{className:"",children:(ue=o.current)==null?void 0:ue.PaymentType.name})]}),a("div",{className:"sign-aclaration my-1",children:[t("div",{className:"sign my-2",children:t("span",{children:"Firma : "})}),t("div",{className:"",children:t("span",{children:"Aclaración : "})})]})]})]},r)})}),a("div",{className:"flex gap-x-2",children:[t("button",{className:"btn sec  !my-4",disabled:Te,onClick:de,children:" Cancelar "}),a("button",{className:"btn gradient !text-sm !my-4",disabled:Te,onClick:Mt,children:[" ",Te?"DESCARGANDO... ":"DESCARGAR"," "]})]})]})]}),a(ot,{show:B,closeModal:ce,overlayClick:!1,titleText:"Cobros",className:" max-w-7xl mx-auto",custom:!0,children:[t(dt,{action:ce}),a("div",{className:"flex w-full flex-col md:flex-row gap-x-4 mt-3 ",children:[a("form",{onSubmit:jt,className:"w-full  sm:flex-grow-[50%] sm:min-w-[600px] border border-gray-100 dark:border-slate-600 p-2",children:[a(A,{children:[a("fieldset",{children:[t("label",{htmlFor:"ContractId",children:"Contrato "}),t(re,{value:p,onChange:qt,options:(et=ze.data)==null?void 0:et.data,optionLabel:"street",showClear:!0,dropdownIcon:()=>t(mt,{}),valueTemplate:(e,r)=>e?a("span",{children:[" ",e.Client.fullName," | ",e.Property.street," ",e.Property.number," ",e.Property.floor,"-",e.Property.dept," "]}):r.placeholder,itemTemplate:e=>a("span",{children:[" ",e.Client.fullName," | ",e.Property.street," ",e.Property.number," ",e.Property.floor,"-",e.Property.dept," "]}),filterBy:"Client.fullName,Property.street,Property.number,Property.floor,Property.dept",placeholder:"elije contrato",filter:!0,filterPlaceholder:"Busca contrato",className:"h-[42px] !w-full  items-center !border-gray-200 shadow "}),(p==null?void 0:p.id)>0&&a("div",{className:"flex items-center gap-4",children:[a("span",{className:"text-blue-600 dark:text-blue-400 text-sm ",children:["Propietario : ",(at=(tt=p==null?void 0:p.Property)==null?void 0:tt.Owner)==null?void 0:at.fullName]}),a("span",{className:"text-blue-600 dark:text-blue-400 text-sm ",children:["Vigencia : ",T(p==null?void 0:p.startDate)," | ",T(p==null?void 0:p.endDate)]})]}),(y==null?void 0:y.ContractId)&&t(it,{text:"El contrato es obligatorio."})]}),a("div",{className:"flex w-full sm:w-20 flex-col mt-4",children:[t("label",{htmlFor:"gestionExpensePorc",children:"%Gestion "}),t("input",{value:Ct,placeholder:"0.00",type:"number",className:"dark:!bg-gray-900 dark:text-slate-400 w-full  border !border-gray-300 dark:!border-slate-700 !shadow ",min:1,max:10,onChange:e=>{ve(Number(e.target.value)),Pe(r=>{var l;return{...r,amount:(Number(e.target.value)/100*((l=p==null?void 0:p.PriceHistorials.sort((i,d)=>i.id-d.id)[(p==null?void 0:p.PriceHistorials.length)-1])==null?void 0:l.amount)).toFixed(2)}})}})]})]}),Ue&&p&&a("div",{className:"text-green-500 dark:text-green-400 text-center my-2",children:["Ya cobraste ",F.length," concepto(s)   para el/los mes(es)  de  ",Array.from(new Set(F.map(e=>{var r;return typeof e.month=="number"?ne[e.month-1]:(r=e.month)!=null&&r.length?e.month:S}))).join(",")]}),xt&&a(k,{className:"dark:!text-red-500 dark:!bg-red-100 rounded-none text-center !p-2 !bg-red-200 mx-0 border-0 my-2 flex items-center gap-4 ",children:[t($e,{size:25}),"El contrato no tiene precio cargado para el 2 año !"]}),Nt&&a(k,{className:"dark:!text-red-500 dark:!bg-red-100 text-center rounded-none !p-2 !bg-red-200 mx-0 border-0 my-2 flex items-center gap-4 ",children:[t($e,{size:25}),"El contrato   no tiene precio cargado para el 3 año !"]}),p!==null&&yt&&a(k,{className:"dark:!text-red-500 dark:!bg-red-100 text-center rounded-none !p-2 !bg-red-200 mx-0 border-0 my-2 flex items-center gap-4 ",children:[t($e,{size:25}),"Este contrato esta vencido . Vencio el ",T(p.endDate)," !"]}),wt?t(Ee,{}):a("div",{className:"mt-4",children:[Qe.length>0&&a("div",{className:" border border-gray-300 dark:border-slate-700 dark:bg-slate-900 p-2",children:[t("h1",{className:"title-form mb-2",children:"Gastos inquilino"}),a("div",{className:"eventualities-section flex flex-col   gap-y-2 gap-x-3",children:[Qe.map((e,r)=>a("div",{title:F.filter(l=>l.description===e.description&&l.ContractId===e.ContractId).length>0?"Ya cobraste este concepto en el mes actual":"",className:"align-items-center flex items-center flex-wrap   border border-gray-300 dark:border-slate-500 p-2",children:[t(he,{inputId:e.id.toString()+e.createdAt+r+e.amount+e.description,name:"expenseClients",value:e,disabled:F.filter(l=>l.description===e.description&&l.ContractId===e.ContractId).length>0,onChange:Bt,checked:f.some(l=>l.id===e.id)}),a("label",{htmlFor:e.id.toString()+e.createdAt+r+e.amount+e.description,className:` ml-2  ${F.filter(l=>l.description===e.description&&l.ContractId===e.ContractId).length>0?" cursor-not-allowed opacity-60 line-through":"cursor-pointer"} `,children:["$",e.amount," | ",e.description]})]},e.id.toString()+e.createdAt+r+e.amount+e.description)),a("div",{className:"align-items-center flex items-center flex-wrap   border border-gray-300 dark:border-slate-500 p-2",children:[t(he,{inputId:n.id.toString()+n.createdAt+n.amount+n.description,name:"expense-gestion",value:n,disabled:F.filter(e=>e.description===n.description&&e.ContractId===n.ContractId).length>0,title:Ue?"Ya cobraste este  mes de "+S+" "+E:"",onChange:()=>{Pe(e=>({...e,checked:!n.checked}))},checked:n.checked}),a("label",{htmlFor:n.id.toString()+n.createdAt+n.amount+n.description,className:` ml-2  ${F.filter(e=>e.description===n.description&&e.ContractId===n.ContractId).length>0?" cursor-not-allowed opacity-60 line-through":"cursor-pointer"} `,children:["$",n.amount," | ",n.description]})]},n.id.toString()+n.createdAt+n.amount+n.description)]})]}),Ve.length>0&&a("div",{className:"my-4  border border-gray-300 dark:border-slate-700 dark:bg-slate-900 p-2",children:[t("h1",{className:"title-form mb-2",children:"Eventualidades"}),t("div",{className:"eventualities-section flex flex-col gap-y-2 gap-x-3",children:Ve.map((e,r)=>a("div",{className:"align-items-center flex items-center  flex-wrap   border border-gray-300 dark:border-slate-500 p-2",children:[t(he,{inputId:e.updatedAt+e.description+r+e.id+e.clientAmount,value:e,name:"eventuality",onChange:Rt,checked:oe.some(l=>l.id===e.id)}),a("label",{htmlFor:e.updatedAt+e.description+r+e.id+e.clientAmount,className:"ml-2",children:["$",e.clientAmount," | ",e.description]})]},e.updatedAt+e.description+r+e.id+e.clientAmount))})]}),Ae.length>0&&a("div",{className:"my-4  border border-gray-300 dark:border-slate-700 dark:bg-slate-900 p-2",children:[t("h1",{className:"title-form mb-2",children:"Deudas anteriores"}),t("div",{className:"eventualities-section flex flex-col gap-y-2 gap-x-3",children:Ae.sort((e,r)=>e.year.toString().concat(e.month.toString()).localeCompare(r.year.toString().concat(r.month.toString()))).map((e,r)=>a("div",{className:`align-items-center flex items-center  flex-wrap border border-gray-300 dark:border-slate-500 p-1 ${le(e.year+"-"+ct(e.month)+"-10",new Date().toString())>70?" !border-red-500":""}`,children:[t(he,{inputId:e.updatedAt+e.id+e.description+e.amount+r,value:e,name:"debtsClients",disabled:e.debtParentId!==void 0,onChange:Lt,checked:Q.some(l=>l.id===e.id)}),t("label",{htmlFor:e.updatedAt+e.id+e.description+e.amount+r,className:"ml-2 ",children:a("span",{className:"",children:["$ ",e.amount," |  ",e.description]})})]},e.updatedAt+e.id+e.description+e.amount+r))})]})]}),a(A,{children:[a(A,{className:"w-full sm:w-[50%] ",children:[t(Fe,{initialValue:S||"",disabled:!0,placeholder:"",onChange:e=>{},label:"Mes",required:!0,hasError:y==null?void 0:y.month,errorText:"El mes de pago es obligatorio."}),t(Fe,{initialValue:E||"",disabled:!0,placeholder:"",onChange:e=>{},label:"Año",required:!0,hasError:y==null?void 0:y.year,errorText:"El año de pago es obligatorio."})]}),t(A,{className:"w-full sm:w-[50%] ",children:a("fieldset",{className:"",children:[t("label",{htmlFor:"PaymentTypeId",children:"Forma de pago "}),t(re,{value:ht,onChange:e=>{var r,l;q(e.value,"PaymentTypeId"),e.value===((l=(r=V.data)==null?void 0:r.data.find(i=>i.name==="Transferencia Bancaria"))==null?void 0:l.id)?ke(we.current):ke(0)},options:(rt=V.data)==null?void 0:rt.data,dropdownIcon:()=>t(mt,{}),optionLabel:"name",filterPlaceholder:"Busca  forma de pago",optionValue:"id",placeholder:"elije forma de pago",filter:!0,className:"h-[42px] items-center !border-gray-200 shadow"}),(y==null?void 0:y.PaymentTypeId)&&t(it,{text:"El formato de pago es obligatorio."})]})})]}),a(A,{children:[a(A,{className:"w-full sm:w-[70%]",children:[a("fieldset",{className:"",children:[t("label",{htmlFor:"",children:"Total Event. "}),t("input",{placeholder:"1234.90",type:"number",disabled:!0,value:x.current,onChange:e=>{}})]}),a("fieldset",{className:"",children:[t("label",{htmlFor:"",children:"Total imp. y deudas "}),t("input",{placeholder:"1234.90",type:"number",disabled:!0,value:N.current+C.current,onChange:e=>{}})]})]}),f.filter(e=>e.paidCurrentMonth).length>0&&a(A,{className:"w-full sm:w-[50%]",children:[a("fieldset",{className:"",children:[t("label",{title:"Cantidad de dias atrasados",htmlFor:"total",children:"C.D.A"}),t("input",{placeholder:"1234.90",name:"qteDays",className:"dark:!bg-gray-900 w-full sm:w-24 dark:text-slate-400 border !border-gray-300 dark:!border-slate-700 !shadow",min:0,type:"number",value:Le??"",onChange:e=>{R({...h,qteDays:Number(e.target.value),recharge:u(Number(e.target.value)*Re)})}})]}),a("fieldset",{className:"",children:[t("label",{htmlFor:"recharge",children:"Tot. recargo"}),t("input",{placeholder:"1234",disabled:!0,name:"total",type:"number",value:u(Le*Re),onChange:e=>q(e.target.value,"recharge")})]})]})]}),a(A,{className:"",children:[a("fieldset",{className:"",children:[t("label",{htmlFor:"total",children:"Total a cobrar"}),t("input",{placeholder:"1234",disabled:!0,name:"total",type:"number",value:n.checked?x.current+N.current+C.current+(f.filter(e=>e.paidCurrentMonth).length>0?w:0)+u(Number(n.amount)):u(x.current+N.current+C.current+(f.filter(e=>e.paidCurrentMonth).length>0?w:0)),onChange:e=>q(e.target.value,"total")})]}),a("fieldset",{className:"",children:[t("label",{htmlFor:"total",children:"Total cobrado"}),t("input",{placeholder:"1234",className:"dark:!bg-gray-900 dark:text-slate-400 border  focus:!border-blue-500 dark:focus:!border-blue-500  !border-gray-300 dark:!border-slate-700 !shadow placeholder:text-slate-300 dark:placeholder:text-slate-700",name:"total",type:"number",value:L,onChange:e=>q(e.target.value,"paidTotal")})]})]}),L>0&&a("div",{className:"text-green-500 dark:text-green-300 p-1 mt-2",children:["Se agregará una eventualidad con un monto de : ","$",n.checked?(x.current+N.current+C.current+(f.filter(e=>e.paidCurrentMonth).length>0?w:0)+Number(n.amount)-L).toFixed(2):u(x.current+N.current+C.current+(f.filter(e=>e.paidCurrentMonth).length>0?w:0)-L)]}),t(ua,{initialValue:gt||"",placeholder:"Pago  transferencia bancaria",onChange:e=>{q(e,"obs")},label:"Observaciones",optional:!0}),t(ta,{savingOrUpdating:qe,onClose:ce})]}),p&&a(k,{className:"shadow-none rounded-none border-none mx-0   p-2",children:[t("h3",{className:"font-bold mb-2 text-lg ",children:"Lista de conceptos a cobrar"}),a("div",{className:"flex justify-between flex-col min-h-[300px] h-[95%]",children:[a("div",{className:"payment-pdf  pt-4 flex-1 gap-y-1 flex flex-col px-1 ",children:[f.map((e,r)=>a("div",{className:"align-items-center uppercase text-sm border-b dark:border-slate-700 flex gap-x-3 items-center  justify-between    border-gray-300",children:[t("span",{className:"",children:e.description}),a("span",{children:["$",e.amount]})]},r)),n.checked&&a("div",{className:"align-items-center uppercase text-sm border-b dark:border-slate-700 flex gap-x-3 items-center  justify-between    border-gray-300",children:[t("span",{className:"",children:n.description}),a("span",{children:["$",n.amount]})]},n.id),oe.map((e,r)=>a("div",{className:"align-items-center uppercase text-sm border-b dark:border-slate-700 flex gap-x-3 items-center  justify-between    border-gray-300",children:[t("span",{className:"",children:e.description}),a("span",{children:["$",e.clientAmount]})]},r)),f.filter(e=>e.paidCurrentMonth).length>0&&a("div",{className:"align-items-center uppercase text-sm border-b dark:border-slate-700 flex gap-x-3 items-center  justify-between    border-gray-300",children:[a("span",{className:"",children:["PUNITORIOS  ",S,"   ",E.toString()]}),a("span",{children:["$",w]})]}),Q.map((e,r)=>a("div",{className:"align-items-center uppercase text-sm border-b dark:border-slate-700 flex gap-x-3 items-center  justify-between    border-gray-300",children:[t("span",{className:"",children:e.description}),a("span",{children:["$",e.amount]})]},r)),D>0&&a("div",{className:"align-items-center uppercase text-sm border-b dark:border-slate-700 flex gap-x-3 items-center  justify-between    border-gray-300",children:[t("span",{className:"",children:"GASTOS BANCARIOS"}),a("span",{children:["$",D]})]})]}),t("div",{className:"mt-auto",children:a("div",{className:"align-items-center uppercase text-sm  flex gap-x-3 items-center  justify-between  mt-3  border-gray-300",children:[t("span",{className:"",children:"Total a cobrar "}),L>0?a("span",{className:"",children:["$",L]}):n.checked?a("span",{children:["$   ",u(Number(n.amount)+D+x.current+N.current+C.current+(f.filter(e=>e.paidCurrentMonth).length>0?w:0))]}):a("span",{children:["$ ",u(x.current+D+N.current+C.current+(f.filter(e=>e.paidCurrentMonth).length>0?w:0))]})]})})]})]})]})]})]})};export{Ba as default};
