import{r as x,j as e,L as N,a as r,H as S}from"./index-3ed1fa78.js";import{R as C,D as k}from"./RequestError-ce21148f.js";import{B as I}from"./Box-2f3a3966.js";import{u as O}from"./useContracts-759ab8e3.js";import{f,e as p,c as w,d as B}from"./date-8ced1934.js";import{h as E}from"./html2pdf-c13131c9.js";import{B as A}from"./BoxContainerPage-d81583a3.js";import"./useQuery-6083f14c.js";const T=()=>{const[d,g]=x.useState(60),[m,h]=x.useState(!1),{data:t,isError:u,error:b,isLoading:y,refetch:D,isFetching:v}=O(`/expired-contracts/${d}`),P=async()=>{h(!0);var a=document.getElementById("pdf-download"),l={margin:[.1,.1],filename:`CONTRATOS_A_VENCER_EN_${d}_DIAS_${f(new Date().toISOString())}.pdf`,html2canvas:{scale:2},jsPDF:{unit:"in",format:"letter",orientation:"landscape"}};try{await E().from(a).set(l).save()}catch(o){console.log(o)}finally{h(!1)}},c=a=>w(w(a,-1,"days").toISOString().slice(0,10),p(a,new Date().toISOString().slice(0,10)),"years"),s=a=>B(a,new Date().toISOString().slice(0,10));return y?e(N,{}):u?e(C,{error:b}):r(A,{className:"",children:[r(I,{className:"expired-contracts !p-0 !m-0 !border-0 !shadow-none !bg-transparent flex items-end gap-x-4",children:[r("fieldset",{className:"w-full sm:w-40 mb-0 ",children:[e("label",{htmlFor:"days",children:"Cantidad de días"}),e(k,{value:d,onChange:a=>g(a.value),dropdownIcon:()=>e("span",{className:"dark:text-slate-400",children:e(S,{})}),options:[30,60,90,120],placeholder:"Cantidad días",className:"h-[42px]  items-center !bg-transparent !border-gray-400 dark:!border-gray-700  dark:!text-slate-400 "})]}),e("button",{className:"btn !bg-transparent border border-brand2 dark:border-brand hover:!bg-gray-100 dark:text-slate-400 dark:hover:!bg-slate-700 dark:hover:!text-slate-300",onClick:()=>D(),children:"Buscar"})]}),r("div",{className:" mx-auto !overflow-x-auto dark:text-slate-500  ",id:"pdf-download",children:[e("h2",{className:"my-4 text-2xl font-semibold leading-tight",children:r("span",{children:["Contratos a Vencer ",e("br",{})," ",r("span",{className:"text-sm",children:[" en los próximos ",d," días "]})]})}),e("div",{className:"!p-0 !m-0 ",children:e("div",{className:"",children:r("div",{className:"w-full  !overflow-x-auto text-xs text-left whitespace-nowrap",children:[e("div",{className:" rounded-t-lg   overflow-hidden",children:r("div",{className:"flex px-1  py-3  font-semibold border-b dark:border-slate-500",children:[e("div",{className:"w-[80px]",children:e("span",{className:"p-3 pl-0",children:"Vence el"})}),e("div",{className:"w-[40px] ",children:e("span",{className:"p-3 pl-0",children:"Resta"})}),e("div",{className:"w-[40px] ",children:e("span",{className:"p-3 pl-0",children:"Cpta"})}),e("div",{className:"w-[150px] ",children:e("span",{className:"p-3 pl-0",children:"Propiedad"})}),e("div",{className:"w-[150px] ",children:e("span",{className:"p-3 pl-0",children:"Propietario"})}),e("div",{className:"w-[150px] ",children:e("span",{className:"p-3 pl-0",children:"Inquilino"})}),e("div",{className:"w-[80px] ",children:e("span",{className:"p-3 pl-0",children:"Monto Alq."})}),e("div",{className:"w-[80px]",children:e("span",{className:"p-3 pl-0",children:"Alq. Neto"})}),e("div",{className:"w-[40px] ",children:e("span",{className:"p-3 pl-0 ",children:"Año"})}),e("div",{className:"w-[220px] ",children:e("span",{className:"p-3 pl-0",children:"Observaciones"})})]})}),e("div",{className:"",children:t==null?void 0:t.data.sort((a,l)=>c(a.startDate).getTime()-c(l.startDate).getTime()).map(a=>{var l,o;return r("div",{className:"flex px-1 border-b border-slate-400 dark:border-slate-700",children:[e("p",{className:"w-[80px]  my-1  truncate p-2 px-0",children:f(c(a.startDate).toISOString().slice(0,10))}),e("p",{className:"w-[40px]  my-1  truncate p-2 px-0",children:s(a.startDate)<=365?365-s(a.startDate):s(a.startDate)>365&&s(a.startDate)<=730?730-s(a.startDate):1095-s(a.startDate)}),e("p",{className:"w-[40px]  my-1  truncate p-2 px-0",children:a.Property.folderNumber}),r("p",{className:"w-[150px]  my-1   truncate p-2 px-0  ",children:[a.Property.street," ",a.Property.number," ",a.Property.dept," - ",a.Property.floor]}),e("p",{className:"w-[150px]  my-1  truncate p-2 px-0",children:(l=a.Property.Owner)==null?void 0:l.fullName}),r("p",{className:"w-[150px]  my-1  truncate p-2 px-0",children:[" ",a.Client.fullName]}),r("p",{className:"w-[80px]  my-1  truncate p-2 px-0",children:["$",a.PriceHistorials.sort((n,i)=>n.id-i.id)[a.PriceHistorials.length-1].amount]}),r("p",{className:"w-[80px]  my-1  truncate p-2 px-0",children:["$",a.PriceHistorials.sort((n,i)=>n.id-i.id)[a.PriceHistorials.length-1].amount-a.PriceHistorials.sort((n,i)=>n.id-i.id)[((o=a.PriceHistorials)==null?void 0:o.length)-1].amount*(a.Property.Owner.commision/100)]}),e("p",{className:"w-[40px]  my-1  truncate p-2 px-0",children:e("span",{className:`${p(a.startDate,new Date().toISOString().slice(0,10))===3&&"text-yellow-500 font-bold"}`,children:p(a.startDate,new Date().toISOString().slice(0,10))})}),e("p",{className:"w-[220px] truncate my-1  p-2 px-0",title:a.description,children:a.description})]},a.id)})})]})})})]}),v&&e(N,{h:60,w:60}),e("button",{className:"btn gradient  !my-4 !w-fit",disabled:m||(t==null?void 0:t.data.length)==0,onClick:P,children:m?"Descargando ... ":`Descargar Planilla (${t==null?void 0:t.data.length})`})]})};export{T as default};
