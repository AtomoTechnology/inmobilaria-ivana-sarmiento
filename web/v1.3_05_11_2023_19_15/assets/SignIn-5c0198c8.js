import{r as t,A as O,a as l,j as e,h as F,z as q,x as B}from"./index-3ed1fa78.js";import{u as D,F as k}from"./FormError-a3fab181.js";import{B as z}from"./Box-2f3a3966.js";import{C as p}from"./CustomInput-6ca7ad9c.js";import{I as R,v as U}from"./form-3a2308eb.js";import{C as V,F as W}from"./FormActionBtns-c23092d4.js";const Y=()=>{const[x,i]=t.useState(!1),[a,d]=t.useState(),[h,c]=t.useState(null),[P,g]=t.useState(!1),[f,b]=t.useState(!1),[w,v]=t.useState(""),{signIn:I,message:y}=t.useContext(O),{values:E,handleInputChange:S,reset:M}=D({email:"",password:""}),[n,C]=t.useState(""),[N,m]=t.useState(""),T=async s=>{s.preventDefault();const{error:r,ok:A}=U({...E});if(d(r),!A)return!1;i(!0);try{const o=await F.post("/auth/signin",E);o.data.ok?(I(o.data),M(),i(!1)):c(o.data.message)}catch(o){o.response&&(c(o.response.data.message),setTimeout(()=>{c(null)},8e3))}finally{i(!1)}},j=()=>{g(!0)},u=()=>{g(!1)},L=async s=>{if(s.preventDefault(),!n)return d({emailForgotPassword:!0});if(!q(n))return d({emailForgotPassword:!0});b(!0),v(""),m("");try{const r=await F.post("/auth/forgot-password",{email:n});r.data.ok&&(C(""),m(r.data.message),setTimeout(()=>{m(""),u()},3e3))}catch(r){B.isAxiosError(r)&&r.response&&v(r.response.data.message||"Error el mandar el mail")}finally{b(!1)}};return l("div",{className:"flex h-screen w-screen dark:bg-gray-900 items-center justify-center",children:[l(z,{className:" w-full max-w-[420px] mx-3 sm:mx-0 sm:w-96 ",children:[l("form",{onSubmit:T,className:"flex items-center justify-between flex-col ",children:[e("h3",{className:"title-form self-start mb-4 !text-xl sm:!text-3xl",children:"Inicia sesión"}),y&&e("div",{className:"bg-red-100 border my-2 border-red-200 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e("strong",{className:"font-bold",children:y})}),h&&e(k,{text:h}),e(p,{type:"email",placeholder:"example@gmail.com",onChange:s=>S(s,"email"),hasError:a==null?void 0:a.email,required:!0,label:"Email",errorText:"Email obligatorio y válido."}),e(p,{type:"password",placeholder:".lk8Tx9W/",onChange:s=>S(s,"password"),required:!0,label:"Contraseña",hasError:a==null?void 0:a.password,errorText:"Contraseña obligatoria ."}),e("fieldset",{children:e("button",{disabled:x,className:"btn gradient",type:"submit",children:x?l("div",{className:"flex items-center gap-4",children:[e("span",{children:"Espere"}),e(R,{})]}):e("span",{children:"Inicia sesión"})})})]}),e("div",{className:"register-section text-sx mt-4 text-center",children:e("span",{className:"text-sm",children:e("button",{type:"button",onClick:()=>{j()},className:"text-pink-700 dark:text-slate-500 ml-1 hover:underline dark:hover:text-brand2  p-1",children:"¿Olvidaste tu contraseña ?"})})})]}),e(V,{show:P,closeModal:u,overlayClick:!1,className:"max-w-[400px] sm:w-[370px] w-[fit]",titleText:"Recuperar contraseña",children:l("form",{onSubmit:L,children:[w&&e(k,{className:"border border-dashed border-red-400 p-1.5 text-center text-sm mt-3",text:w}),N&&l("div",{className:"border border-dashed border-green-400 p-1.5 text-center text-sm mt-3",children:[e("div",{children:N}),e("span",{className:"text-xs",children:"Se ha enviado un correo con las instrucciones para cambiar la contraseña"})]}),e(p,{placeholder:"example@gmail.test",initialValue:n,disabled:f,onChange:s=>C(s),maxLength:100,type:"email",label:"Email",required:!0,hasError:a==null?void 0:a.emailForgotPassword,errorText:"El mail es obligatorio y debe ser valido."}),e(W,{savingOrUpdating:f,onClose:u,btnSendText:"Enviar"})]})})]})};export{Y as default};
