import{h as x,r as d,f as N,j as r,L as G,a,F as ne}from"./index-3ed1fa78.js";import{u as ie,H as de,D as ce,C as y,a as me}from"./HeaderData-f8341142.js";import{B as pe}from"./Box-2f3a3966.js";import{E as ue}from"./EditIcon-72ee5f20.js";import{D as he}from"./DeleteIcon-e6cc714b.js";import{C as fe,F as ye}from"./FormActionBtns-c23092d4.js";import{C as v}from"./CustomInput-6ca7ad9c.js";import{u as ge,F as L}from"./FormError-a3fab181.js";import{R as be,D as q}from"./RequestError-ce21148f.js";import{u as xe}from"./useContracts-759ab8e3.js";import{F as V}from"./FieldsetGroup-13ce1fee.js";import{u as Ce}from"./useQuery-6083f14c.js";import{v as we}from"./form-3a2308eb.js";import{f as ke}from"./date-8ced1934.js";import{E as Ee}from"./EmptyData-5a33961e.js";import{C as Ne}from"./CloseOnClick-54123682.js";const ve=async()=>await x.get("/owner-expenses?sort=ContractId").then(g=>g.data),Pe=()=>Ce({queryKey:["owner-expenses"],queryFn:ve}),Ye=()=>{var O,T;const[g,u]=d.useState(!1),[P,C]=d.useState(!1),{description:H,amount:U,date:Y,ContractId:$,values:w,handleInputChange:b,reset:k,updateAll:R}=ge({description:"",amount:0,date:new Date().toISOString().slice(0,10),ContractId:0}),[s,F]=d.useState(),[A,M]=d.useState(!1),[K,Q]=d.useState(""),[S,z]=d.useState({global:{value:null,matchMode:N.CONTAINS},description:{value:null,matchMode:N.CONTAINS},"Contract.Property.street":{value:null,matchMode:N.CONTAINS}}),m=d.useRef(),{showAndHideModal:i}=ie(),[I,p]=d.useState(!1),{data:n,isError:Z,isLoading:_,error:J,isFetching:W,refetch:D}=Pe(),X=xe(),ee=e=>{R({...e}),u(!0),M(!0),m.current=e},re=e=>{C(!P),m.current=e},te=e=>{const l=e;let o={...S};o.global.value=l,z(o),Q(l)},ae=async e=>{var l;try{p(!0);const o=await x.delete("/owner-expenses/"+e);o.data.ok?(n!=null&&n.data&&(n.data=n==null?void 0:n.data.filter(c=>c.id!==e)),C(!1),i("Borrado",o.data.message)):i("Error",o.data.message||"Algo malo ocurrío.","red")}catch(o){o.response&&i("Error",((l=o.response.data)==null?void 0:l.message)||"Algo malo ocurrío.","red")}finally{p(!1)}},oe=async e=>{var c,h,f;e.preventDefault();const{error:l,ok:o}=we({...w});if(F(l),!o)return!1;if(A)try{p(!0);const t=await x.put(`/owner-expenses/${(c=m.current)==null?void 0:c.id}`,w);t.data.ok?(D(),k(),u(!1),i("Editado",t.data.message)):i("Error",t.data.message||"Algo malo ocurrío.","red")}catch(t){t.response&&i("Error",((h=t.response.data)==null?void 0:h.message)||"Algo malo ocurrío.","red")}finally{p(!1)}else try{p(!0);const t=await x.post("/owner-expenses",w);t.data.ok?(D(),k(),u(!1),i("Guardado",t.data.message)):i("Error",t.data.message||"Algo malo ocurrío.","red")}catch(t){t.response&&i("Error",((f=t.response.data)==null?void 0:f.message)||"Algo malo ocurrío.","red")}finally{p(!1)}},E=()=>{k(),u(!1),F({})},se=e=>a("div",{className:"flex gap-x-3 items-center justify-center",children:[r(ue,{action:()=>ee(e)}),r(he,{action:()=>re(e)})]}),le=()=>{M(!1),m.current=null,u(!0)};return _?r(G,{}):Z?r(be,{error:J}):a("div",{className:"container m-auto  flex sm:mx-0  flex-col justify-center sm:justify-center",children:[r(de,{action:le,text:"Impuestos propietarios"}),n.data.length>0?a(ne,{children:[r(v,{onChange:e=>te(e),className:" w-auto mx-2 sm:mx-0 sm:w-96",initialValue:K,placeholder:"Buscar impuesto",type:"search"}),r(pe,{className:"!p-0 !overflow-hidden !border-none sm:mx-0    mb-4 ",children:a(ce,{size:"small",emptyMessage:"Aún no hay impuesto",className:"!overflow-hidden   !border-none",value:n==null?void 0:n.data,filters:S,globalFilterFields:["Contract.Property.street","description"],dataKey:"id",responsiveLayout:"scroll",children:[r(y,{field:"Contract.Property.street",body:e=>{var l,o,c,h,f,t,j,B;return a("span",{children:[(o=(l=e.Contract)==null?void 0:l.Property)==null?void 0:o.street," ",(h=(c=e.Contract)==null?void 0:c.Property)==null?void 0:h.number," ",(t=(f=e.Contract)==null?void 0:f.Property)==null?void 0:t.floor," ",(B=(j=e.Contract)==null?void 0:j.Property)==null?void 0:B.dept]})},header:"Propiedad",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",sortable:!0}),r(y,{field:"description",body:e=>a("span",{title:e.description,children:[e.description.slice(0,30)," ",e.description.length>30?"...":""]}),sortable:!0,header:"Descripción",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),r(y,{field:"amount",sortable:!0,header:"Monto",body:e=>a("span",{children:["$",e.amount]}),headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),r(y,{field:"date",sortable:!0,body:e=>r("span",{children:ke(e.date)}),header:"Fecha",headerClassName:"!border-none dark:!bg-gray-800 dark:!text-slate-400",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 "}),r(y,{body:se,headerClassName:"!border-none dark:!bg-gray-800",className:"dark:bg-slate-700 dark:text-slate-400 dark:!border-slate-600 ",exportable:!1,style:{width:90}})]})})]}):r(Ee,{text:"Aún no hay Impuesto"}),W&&r(G,{h:40,w:40}),r(me,{show:P,savingOrUpdating:I,setShow:C,destroy:()=>{var e;return ae((e=m.current)==null?void 0:e.id)},text:`${(O=m.current)==null?void 0:O.description}`}),a(fe,{show:g,closeModal:E,overlayClick:!1,className:"max-w-[1000px]  sm:w-[600px]",titleText:`${A?"Editar":"Agregar "} impuesto propietario`,children:[r(Ne,{action:E}),a("form",{onSubmit:oe,children:[a(V,{children:[a("fieldset",{className:"w-full sm:!max-w-[400px] sm:w-[70%]",children:[r("label",{htmlFor:"ContractId",children:"Contrato "}),r(q,{value:$,onChange:e=>b(e.value,"ContractId"),options:(T=X.data)==null?void 0:T.data,optionLabel:"street",showClear:!0,valueTemplate:(e,l)=>e?a("span",{children:[" ",e.Property.Owner.fullName," | ",e.Property.street," ",e.Property.number," ",e.Property.floor,"-",e.Property.dept," "]}):l.placeholder,itemTemplate:e=>a("span",{children:[" ",e.Property.Owner.fullName," | ",e.Property.street," ",e.Property.number," ",e.Property.floor,"-",e.Property.dept," "]}),filterBy:"Client.fullName,Property.street,Property.number,Property.floor,Property.dept",optionValue:"id",placeholder:"elije contrato",filter:!0,filterPlaceholder:"Busca contrato",className:"h-[42px] items-center !border-gray-200 shadow sm:!max-w-[400px] "}),(s==null?void 0:s.ContractId)&&r(L,{text:"El contrato es obligatorio."})]}),r("div",{className:"w-full sm:w-[30%]",children:r(v,{placeholder:"123.99",initialValue:U||"",type:"number",onChange:e=>b(e,"amount"),label:"Monto",required:!0,hasError:s==null?void 0:s.amount,errorText:"El monto es obligatorio."})})]}),a(V,{children:[a("fieldset",{className:"w-full",children:[r("label",{htmlFor:"ContractId",children:"Descripción "}),r(q,{placeholder:"elije tipo de impuesto",value:H,options:["Seguro","Expensas","LUZ","GAS","AGUAS","TGI","API","Compensación"],onChange:e=>b(e.value,"description"),className:"h-[42px] items-center !border-gray-200 shadow ",required:!0}),(s==null?void 0:s.description)&&r(L,{text:"La descripción es obligatoria."})]}),r(v,{placeholder:"01/01/2023",type:"date",initialValue:Y,onChange:e=>b(e,"date"),label:"Fecha",required:!0,hasError:s==null?void 0:s.date,errorText:"La fecha es obligatoria."})]}),r(ye,{savingOrUpdating:I,onClose:E})]})]})]})};export{Ye as default};
